{"timestamp":"2025-06-10T16:06:51.428519","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-10T16:06:51.428914","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/sql_queries_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-10T16:06:51.447544Z","level":"info","event":"✅ PostgresHook imported successfully","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:51.451426Z","level":"info","event":"✅ PostgresOperator imported successfully","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:51.451583Z","level":"info","event":"✅ PostgreSQL provider fully available","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:51.497694Z","level":"info","event":"✅ Recreated environment variable: AIRFLOW_CONN_SUPABASE_POSTGRES","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:51.497857Z","level":"info","event":"🔄 Creating google_scraper_eventos table with georeference data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:51.498057Z","level":"info","event":"📋 Executing: create_eventos_table","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:51.925358Z","level":"info","event":"✅ create_eventos_table: executed successfully","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:51.926487Z","level":"info","event":"📋 Executing: check_centroids_table","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:52.353563Z","level":"info","event":"✅ check_centroids_table: [(1,)]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:52.353818Z","level":"info","event":"✅ public.centroids table found","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:52.353974Z","level":"info","event":"📋 Executing: check_staging_table","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:52.716705Z","level":"info","event":"✅ check_staging_table: [(1,)]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:52.717129Z","level":"info","event":"✅ Source table google_scraper.artigos_filtrados_staging found","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:52.717338Z","level":"info","event":"📋 Executing: check_source_columns","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.102202Z","level":"info","event":"✅ check_source_columns: [('ID', 'text'), ('type', 'text'), ('subtype', 'text'), ('date', 'text'), ('year', 'integer'), ('month', 'integer'), ('day', 'integer'), ('hour', 'text'), ('georef', 'text'), ('district', 'text'), ('municipali', 'text'), ('parish', 'text'), ('DICOFREG', 'double precision'), ('source', 'text'), ('sourcedate', 'text'), ('sourcetype', 'text'), ('page', 'text'), ('fatalities', 'integer'), ('injured', 'integer'), ('evacuated', 'integer'), ('displaced', 'integer'), ('missing', 'integer'), ('relevance_score', 'integer'), ('evento_nome', 'text')]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.102418Z","level":"info","event":"📋 Executing: check_centroids_columns","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.486408Z","level":"info","event":"✅ check_centroids_columns: [('id', 'integer'), ('latitude', 'double precision'), ('longitude', 'double precision'), ('name', 'character varying'), ('region', 'character varying'), ('distrito', 'character varying'), ('concelho', 'character varying'), ('freguesia', 'character varying'), ('dicofre', 'character varying'), ('area_ha', 'double precision'), ('cluster_id', 'integer'), ('centroid_type', 'character varying'), ('created_at', 'timestamp without time zone'), ('updated_at', 'timestamp without time zone')]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.487594Z","level":"info","event":"📋 Executing: check_source_data_count","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.927329Z","level":"info","event":"✅ check_source_data_count: [(253,)]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.928344Z","level":"info","event":"📊 Source table has 253 records","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.928771Z","level":"info","event":"✅ Ready to process 253 records","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:53.928990Z","level":"info","event":"📋 Executing: debug_source_table_content","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:54.279414Z","level":"info","event":"✅ debug_source_table_content: [(253, 253)]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:54.280690Z","level":"info","event":"📋 Executing: debug_sample_source_data","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:54.677510Z","level":"info","event":"✅ debug_sample_source_data: [('4313c50be2f5aedf1c3c368cc60bfa91', 'Other', 'Other', '20/03/2025', 2025, 3, 20, '07:00', 'aveiro', 'Aveiro', 'Aveiro', 'aveiro', nan, 'noticiasdeaveiro', '2025-05-24', 'web', 'https://www.noticiasdeaveiro.pt/tempestade-martinho-trouxe-vento-forte-a-regiao-de-aveiro/', 0, 0, 0, 0, 0, 2, 'martinho'), ('5c75c49fc92a58f7175b71c31d153aae', 'Other', 'Other', '30/04/2025', 2025, 4, 30, '07:00', 'avis', 'Portalegre', 'Avis', 'avis', 120303.0, 'dnoticias', '2025-05-24', 'web', 'https://www.dnoticias.pt/2025/4/30/447061-madeira-com-chuva-neve-trovoada-e-vento-forte/', 0, 0, 0, 0, 0, 2, 'desconhecido'), ('8e09543eb9f3ac3a5769ea9ff579c0e7', 'Other', 'Other', '09/03/2025', 2025, 3, 9, '08:00', 'porto', 'Porto', 'Porto', 'porto', nan, 'dnoticias', '2025-05-24', 'web', 'https://www.dnoticias.pt/2025/3/9/441012-ceu-muito-nublado-aguaceiros-vento-forte-e-possibilidade-de-queda-de-neve-na-madeira/', 0, 0, 0, 0, 0, 1, 'desconhecido')]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:54.678257Z","level":"info","event":"📋 Executing: clear_existing_eventos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.042219Z","level":"info","event":"✅ clear_existing_eventos: executed successfully","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.042594Z","level":"info","event":"📋 Executing: populate_eventos_table_simple","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.449012Z","level":"info","event":"✅ populate_eventos_table_simple: executed successfully","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.449539Z","level":"info","event":"📋 Executing: add_coordinates_to_eventos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.866662Z","level":"info","event":"❌ Direct SQL execution failed: COALESCE types character varying and double precision cannot be matched","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.867155Z","level":"info","event":"LINE 66:                                 e.dicofreg","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.867360Z","level":"info","event":"                                         ^","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.867581Z","level":"info","event":"","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.867803Z","level":"info","event":"❌ add_coordinates_to_eventos failed: COALESCE types character varying and double precision cannot be matched","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.867995Z","level":"info","event":"LINE 66:                                 e.dicofreg","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.868226Z","level":"info","event":"                                         ^","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.868470Z","level":"info","event":"","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:55.868713Z","level":"info","event":"📋 Executing: debug_coordinate_lookup","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:56.242178Z","level":"info","event":"✅ debug_coordinate_lookup: [('Coordinate Lookup Debug', 253, 0, 253, 3551)]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:56.242472Z","level":"info","event":"📋 Executing: sample_coordinate_matches","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:56.664634Z","level":"info","event":"✅ sample_coordinate_matches: [('Braga', 'Braga', 'braga', None, None, 'braga', 'Missing coordinates'), ('Lisboa', 'Lisboa', 'lisboa', None, None, 'lisboa', 'Missing coordinates'), ('Beja', 'Beja', 'beja', None, None, 'beja', 'Missing coordinates'), ('Lisboa', 'Lisboa', 'lisboa', None, None, 'lisboa', 'Missing coordinates'), ('Guarda', 'Guarda', 'guarda', None, None, 'guarda', 'Missing coordinates'), ('Lisboa', 'Oeiras', 'oeiras', None, None, 'oeiras', 'Missing coordinates'), ('Lisboa', 'Lisboa', 'lisboa', None, None, 'lisboa', 'Missing coordinates'), ('Braga', 'Braga', 'braga', None, None, 'braga', 'Missing coordinates'), ('Aveiro', 'Águeda', 'águeda', None, None, 'águeda', 'Missing coordinates'), ('Braga', 'Braga', 'braga', None, None, 'braga', 'Missing coordinates')]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:56.665957Z","level":"info","event":"📋 Executing: verify_eventos_count","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.028647Z","level":"info","event":"✅ verify_eventos_count: [(253,)]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.030387Z","level":"info","event":"📋 Executing: sample_eventos_data","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.409136Z","level":"info","event":"✅ sample_eventos_data: [('1e7b264012f0c756510c24929ec6b999', 'Other', 'Other', 'Braga', 'Braga', None, None, 'braga', 0, 'radioeste', datetime.datetime(2025, 6, 10, 16, 6, 55, 418526)), ('c81bb8fc97d9e46bb1c2c23eef80f3c6', 'Other', 'Other', 'Lisboa', 'Lisboa', None, None, 'lisboa', 0, 'cnnportugal', datetime.datetime(2025, 6, 10, 16, 6, 55, 418526)), ('10b7b25cbc974cfab657a243c11e6607', 'Other', 'Other', 'Beja', 'Beja', None, None, 'beja', 0, 'nit', datetime.datetime(2025, 6, 10, 16, 6, 55, 418526)), ('cdd6b210e8cab01630c07409c617a5c9', 'Other', 'Other', 'Lisboa', 'Lisboa', None, None, 'lisboa', 0, 'executivedigest', datetime.datetime(2025, 6, 10, 16, 6, 55, 418526)), ('9ee0b8d714173c75a9b8613d196839f6', 'Other', 'Other', 'Braga', 'Braga', None, None, 'braga', 0, 'ominho', datetime.datetime(2025, 6, 10, 16, 6, 55, 418526))]","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.409415Z","level":"info","event":"📊 Eventos Table Creation Summary:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.409669Z","level":"info","event":"  - Centroids table available: ✅","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.410031Z","level":"info","event":"  - Staging table available: ✅","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.410300Z","level":"info","event":"  - Total eventos created: 253","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.410514Z","level":"info","event":"🎉 google_scraper_eventos table creation completed!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.410687Z","level":"info","event":"👉 Check your Supabase dashboard to see the new table with georeference data","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-10T16:06:57.409789","level":"info","event":"Done. Returned value was: None","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
