{"timestamp":"2025-06-05T17:15:20.075616","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-05T17:15:20.075991","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-05T17:15:20.162578Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.163247Z","level":"info","event":"📅 Using current date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.172745Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/05', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/05', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/05']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.172909Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.172971Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.173020Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.173142Z","level":"info","event":"  - Target date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.173266Z","level":"info","event":"  - Database table: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.173378Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.178219Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.178397Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/artigos_vitimas_filtrados_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.178978Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/artigos_sem_vitimas_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.179091Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.179461Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (916 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.179552Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.179875Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (916 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180133Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/processing_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180291Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/processing_stats_20250605.json (416 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180537Z","level":"info","event":"📋 Selected input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (916 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180631Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180767Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180841Z","level":"info","event":"  - export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_log_20250605.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180915Z","level":"info","event":"  - export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.180992Z","level":"info","event":"  - backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.181063Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/scripts/google_scraper/data/processed/2025/06/05 --date_str 2025-06-05 --input_file /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv --date 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:20.181169Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.051029Z","level":"info","event":"📋 [2025-06-05 18:15:21] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053295Z","level":"info","event":"📋 2025-06-05 18:15:21,049 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053485Z","level":"info","event":"📋 [2025-06-05 18:15:21] Parâmetros: date=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053587Z","level":"info","event":"📋 2025-06-05 18:15:21,049 - INFO - Parâmetros: date=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053675Z","level":"info","event":"📋 [2025-06-05 18:15:21] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053759Z","level":"info","event":"📋 2025-06-05 18:15:21,050 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053832Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🚀 A iniciar exportação para Supabase para a data: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053911Z","level":"info","event":"📋 2025-06-05 18:15:21,050 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.053964Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📋 Tabela de destino: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054015Z","level":"info","event":"📋 2025-06-05 18:15:21,050 - INFO - 📋 Tabela de destino: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054059Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054107Z","level":"info","event":"📋 2025-06-05 18:15:21,050 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054159Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054250Z","level":"info","event":"📋 2025-06-05 18:15:21,050 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054297Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054340Z","level":"info","event":"📋 2025-06-05 18:15:21,050 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054511Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054592Z","level":"info","event":"📋 2025-06-05 18:15:21,053 - INFO - 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054659Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054712Z","level":"info","event":"📋 2025-06-05 18:15:21,054 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054776Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054855Z","level":"info","event":"📋 2025-06-05 18:15:21,054 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054927Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.054994Z","level":"info","event":"📋 2025-06-05 18:15:21,054 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055063Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055120Z","level":"info","event":"📋 2025-06-05 18:15:21,054 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055183Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055249Z","level":"info","event":"📋 2025-06-05 18:15:21,054 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055322Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055401Z","level":"info","event":"📋 2025-06-05 18:15:21,055 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055563Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055634Z","level":"info","event":"📋 2025-06-05 18:15:21,055 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055694Z","level":"info","event":"📋 [2025-06-05 18:15:21]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055756Z","level":"info","event":"📋 2025-06-05 18:15:21,055 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055832Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.055971Z","level":"info","event":"📋 2025-06-05 18:15:21,055 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.056147Z","level":"info","event":"📋 [2025-06-05 18:15:21]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.056239Z","level":"info","event":"📋 2025-06-05 18:15:21,055 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.056317Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.056583Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.056902Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📄 Tamanho do ficheiro .env: 184 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.056991Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO - 📄 Tamanho do ficheiro .env: 184 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.057802Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.057870Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.057940Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058015Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058085Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058173Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058257Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058330Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058463Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058527Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058641Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ✅ Definido DB_SSLMODE do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.058717Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_SSLMODE do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059010Z","level":"info","event":"📋 [2025-06-05 18:15:21]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059056Z","level":"info","event":"📋 2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059118Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059182Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059225Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059268Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059311Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059357Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059396Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059562Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059679Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059741Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059789Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059859Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.059938Z","level":"info","event":"📋 [2025-06-05 18:15:21]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.060031Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.060096Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.060168Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.060222Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.060271Z","level":"info","event":"📋 2025-06-05 18:15:21,057 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.478677Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.479513Z","level":"info","event":"📋 2025-06-05 18:15:21,477 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.546525Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.546826Z","level":"info","event":"📋 2025-06-05 18:15:21,546 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.640527Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.640810Z","level":"info","event":"📋 2025-06-05 18:15:21,640 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.767309Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.771342Z","level":"info","event":"📋 2025-06-05 18:15:21,766 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.771469Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.771575Z","level":"info","event":"📋 2025-06-05 18:15:21,766 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.771660Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.771726Z","level":"info","event":"📋 2025-06-05 18:15:21,767 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.771819Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Preparadas 3 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.771881Z","level":"info","event":"📋 2025-06-05 18:15:21,771 - INFO - ✅ Preparadas 3 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.945591Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Inseridos/atualizados 3 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.949552Z","level":"info","event":"📋 2025-06-05 18:15:21,945 - INFO - ✅ Inseridos/atualizados 3 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.953092Z","level":"info","event":"📋 [2025-06-05 18:15:21] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.953312Z","level":"info","event":"📋 2025-06-05 18:15:21,952 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.954552Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.958507Z","level":"info","event":"📋 2025-06-05 18:15:21,954 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.959502Z","level":"info","event":"📋 [2025-06-05 18:15:21] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.959638Z","level":"info","event":"📋 2025-06-05 18:15:21,954 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.959813Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.959910Z","level":"info","event":"📋 2025-06-05 18:15:21,954 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.960035Z","level":"info","event":"📋 [2025-06-05 18:15:21] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.960110Z","level":"info","event":"📋 2025-06-05 18:15:21,954 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.960189Z","level":"info","event":"📋 [2025-06-05 18:15:21] ✅ Exportação concluída com sucesso. Processados 3 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:21.960284Z","level":"info","event":"📋 2025-06-05 18:15:21,955 - INFO - ✅ Exportação concluída com sucesso. Processados 3 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:22.060730Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:22.060939Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:22.061056Z","level":"info","event":"⚠️ export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_log_20250605.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:22.061183Z","level":"info","event":"✅ export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json (929 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:22.061310Z","level":"info","event":"✅ backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv (914 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:15:22.062144","level":"info","event":"Done. Returned value was: [2025-06-05 18:15:21] A iniciar export_to_supabase_airflow\n2025-06-05 18:15:21,049 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-05 18:15:21] Parâmetros: date=2025-06-05\n2025-06-05 18:15:21,049 - INFO - Parâmetros: date=2025-06-05\n[2025-06-05 18:15:21] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05\n2025-06-05 18:15:21,050 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05\n[2025-06-05 18:15:21] 🚀 A iniciar exportação para Supabase para a data: 2025-06-05\n2025-06-05 18:15:21,050 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-05\n[2025-06-05 18:15:21] 📋 Tabela de destino: artigos_filtrados_20250605_staging\n2025-06-05 18:15:21,050 - INFO - 📋 Tabela de destino: artigos_filtrados_20250605_staging\n[2025-06-05 18:15:21] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05\n2025-06-05 18:15:21,050 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05\n[2025-06-05 18:15:21] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n2025-06-05 18:15:21,050 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n[2025-06-05 18:15:21] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n2025-06-05 18:15:21,050 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n[2025-06-05 18:15:21] 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-05 18:15:21,053 - INFO - 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-05 18:15:21] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-05 18:15:21,054 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-05 18:15:21] 🔍 Verificação inicial do ambiente...\n2025-06-05 18:15:21,054 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-05 18:15:21]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-05 18:15:21,054 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-05 18:15:21]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-05 18:15:21,054 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-05 18:15:21]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-05 18:15:21,054 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-05 18:15:21] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-05 18:15:21,055 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-05 18:15:21] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-05 18:15:21,055 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-05 18:15:21]   A verificar: /opt/airflow/.env\n2025-06-05 18:15:21,055 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-05 18:15:21]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-05 18:15:21,055 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-05 18:15:21]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-05 18:15:21,055 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-05 18:15:21] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-05 18:15:21,056 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-05 18:15:21] 📄 Tamanho do ficheiro .env: 184 caracteres\n2025-06-05 18:15:21,056 - INFO - 📄 Tamanho do ficheiro .env: 184 caracteres\n[2025-06-05 18:15:21]   ✅ Definido DB_HOST do .env\n2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-05 18:15:21]   ✅ Definido DB_PORT do .env\n2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-05 18:15:21]   ✅ Definido DB_NAME do .env\n2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-05 18:15:21]   ✅ Definido DB_USER do .env\n2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-05 18:15:21]   ✅ Definido DB_PASSWORD do .env\n2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-05 18:15:21]   ✅ Definido DB_SSLMODE do .env\n2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_SSLMODE do .env\n[2025-06-05 18:15:21]   ✅ Definido DB_SCHEMA do .env\n2025-06-05 18:15:21,056 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-05 18:15:21] 🔍 Verificação final da configuração...\n2025-06-05 18:15:21,057 - INFO - 🔍 Verificação final da configuração...\n[2025-06-05 18:15:21]   DB_HOST: DEFINIDO\n2025-06-05 18:15:21,057 - INFO -   DB_HOST: DEFINIDO\n[2025-06-05 18:15:21]   DB_USER: DEFINIDO\n2025-06-05 18:15:21,057 - INFO -   DB_USER: DEFINIDO\n[2025-06-05 18:15:21]   DB_PASSWORD: DEFINIDO\n2025-06-05 18:15:21,057 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-05 18:15:21]   DB_PORT: 6543\n2025-06-05 18:15:21,057 - INFO -   DB_PORT: 6543\n[2025-06-05 18:15:21]   DB_NAME: postgres\n2025-06-05 18:15:21,057 - INFO -   DB_NAME: postgres\n[2025-06-05 18:15:21]   DB_SCHEMA: google_scraper\n2025-06-05 18:15:21,057 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-05 18:15:21] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-05 18:15:21,057 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-05 18:15:21] 🔗 A conectar à base de dados...\n2025-06-05 18:15:21,057 - INFO - 🔗 A conectar à base de dados...\n[2025-06-05 18:15:21] ✅ Conectado à base de dados com sucesso\n2025-06-05 18:15:21,477 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-05 18:15:21] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia\n2025-06-05 18:15:21,546 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia\n[2025-06-05 18:15:21] ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto\n2025-06-05 18:15:21,640 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto\n[2025-06-05 18:15:21] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging\n2025-06-05 18:15:21,766 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging\n[2025-06-05 18:15:21] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-05 18:15:21,766 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-05 18:15:21] 📅 A converter formatos de data...\n2025-06-05 18:15:21,767 - INFO - 📅 A converter formatos de data...\n[2025-06-05 18:15:21] ✅ Preparadas 3 linhas para inserção\n2025-06-05 18:15:21,771 - INFO - ✅ Preparadas 3 linhas para inserção\n[2025-06-05 18:15:21] ✅ Inseridos/atualizados 3 artigos (falharam: 0)\n2025-06-05 18:15:21,945 - INFO - ✅ Inseridos/atualizados 3 artigos (falharam: 0)\n[2025-06-05 18:15:21] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n2025-06-05 18:15:21,952 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n[2025-06-05 18:15:21] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json\n2025-06-05 18:15:21,954 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json\n[2025-06-05 18:15:21] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n2025-06-05 18:15:21,954 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n[2025-06-05 18:15:21] ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging\n2025-06-05 18:15:21,954 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging\n[2025-06-05 18:15:21] 🔗 Ligação à base de dados fechada\n2025-06-05 18:15:21,954 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-05 18:15:21] ✅ Exportação concluída com sucesso. Processados 3 artigos\n2025-06-05 18:15:21,955 - INFO - ✅ Exportação concluída com sucesso. Processados 3 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
{"timestamp":"2025-06-05T20:06:57.073404","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-05T20:06:57.073711","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-05T20:06:57.123585Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.123748Z","level":"info","event":"📅 Using current date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.124094Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/05', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/05', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/05']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.124223Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.124287Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.124356Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.124416Z","level":"info","event":"  - Target date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.124474Z","level":"info","event":"  - Database table: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.124532Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.130966Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.131097Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/artigos_vitimas_filtrados_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.131555Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/artigos_sem_vitimas_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.131631Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.131922Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (1907 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132045Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132148Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (1907 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132262Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/processing_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132359Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/processing_stats_20250605.json (416 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132460Z","level":"info","event":"📋 Selected input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (1907 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132553Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132640Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132784Z","level":"info","event":"  - export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_log_20250605.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132871Z","level":"info","event":"  - export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.132951Z","level":"info","event":"  - backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.133021Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/scripts/google_scraper/data/processed/2025/06/05 --date_str 2025-06-05 --input_file /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv --date 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:57.133167Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.088054Z","level":"info","event":"📋 [2025-06-05 21:06:58] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.088551Z","level":"info","event":"📋 2025-06-05 21:06:58,087 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.088668Z","level":"info","event":"📋 [2025-06-05 21:06:58] Parâmetros: date=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.088726Z","level":"info","event":"📋 2025-06-05 21:06:58,088 - INFO - Parâmetros: date=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.088780Z","level":"info","event":"📋 [2025-06-05 21:06:58] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.088830Z","level":"info","event":"📋 2025-06-05 21:06:58,088 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.088883Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🚀 A iniciar exportação para Supabase para a data: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.089010Z","level":"info","event":"📋 2025-06-05 21:06:58,088 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.089076Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📋 Tabela de destino: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.089127Z","level":"info","event":"📋 2025-06-05 21:06:58,088 - INFO - 📋 Tabela de destino: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.089979Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.090332Z","level":"info","event":"📋 2025-06-05 21:06:58,088 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.090422Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.090527Z","level":"info","event":"📋 2025-06-05 21:06:58,088 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.090581Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.090629Z","level":"info","event":"📋 2025-06-05 21:06:58,088 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.090777Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.091125Z","level":"info","event":"📋 2025-06-05 21:06:58,090 - INFO - 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.091267Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.091467Z","level":"info","event":"📋 2025-06-05 21:06:58,090 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.091552Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.091608Z","level":"info","event":"📋 2025-06-05 21:06:58,090 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.091656Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092206Z","level":"info","event":"📋 2025-06-05 21:06:58,090 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092287Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092377Z","level":"info","event":"📋 2025-06-05 21:06:58,090 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092476Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092585Z","level":"info","event":"📋 2025-06-05 21:06:58,090 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092660Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092827Z","level":"info","event":"📋 2025-06-05 21:06:58,090 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.092947Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093185Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093264Z","level":"info","event":"📋 [2025-06-05 21:06:58]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093331Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093396Z","level":"info","event":"📋 [2025-06-05 21:06:58]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093453Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093517Z","level":"info","event":"📋 [2025-06-05 21:06:58]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093592Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093667Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093730Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093831Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093900Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.093979Z","level":"info","event":"📋 [2025-06-05 21:06:58]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094060Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094123Z","level":"info","event":"📋 [2025-06-05 21:06:58]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094225Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094301Z","level":"info","event":"📋 [2025-06-05 21:06:58]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094349Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094410Z","level":"info","event":"📋 [2025-06-05 21:06:58]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094475Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094523Z","level":"info","event":"📋 [2025-06-05 21:06:58]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094583Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094645Z","level":"info","event":"📋 [2025-06-05 21:06:58]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094718Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094824Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094881Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.094965Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095033Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095102Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095171Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095246Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095313Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095383Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095450Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095513Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095572Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095679Z","level":"info","event":"📋 [2025-06-05 21:06:58]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.095768Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.096082Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.096435Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.096620Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.096788Z","level":"info","event":"📋 2025-06-05 21:06:58,091 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.350834Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.351280Z","level":"info","event":"📋 2025-06-05 21:06:58,350 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.398482Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.399046Z","level":"info","event":"📋 2025-06-05 21:06:58,398 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.453819Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.455180Z","level":"info","event":"📋 2025-06-05 21:06:58,453 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.548096Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.550159Z","level":"info","event":"📋 2025-06-05 21:06:58,547 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.550988Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.551269Z","level":"info","event":"📋 2025-06-05 21:06:58,548 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.551446Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.551590Z","level":"info","event":"📋 2025-06-05 21:06:58,548 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.560221Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Preparadas 7 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.560756Z","level":"info","event":"📋 2025-06-05 21:06:58,560 - INFO - ✅ Preparadas 7 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.867658Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Inseridos/atualizados 7 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.868198Z","level":"info","event":"📋 2025-06-05 21:06:58,867 - INFO - ✅ Inseridos/atualizados 7 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.874734Z","level":"info","event":"📋 [2025-06-05 21:06:58] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.875417Z","level":"info","event":"📋 2025-06-05 21:06:58,874 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.876391Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.879144Z","level":"info","event":"📋 2025-06-05 21:06:58,876 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.881098Z","level":"info","event":"📋 [2025-06-05 21:06:58] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.884040Z","level":"info","event":"📋 2025-06-05 21:06:58,876 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.884333Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.884526Z","level":"info","event":"📋 2025-06-05 21:06:58,876 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.884827Z","level":"info","event":"📋 [2025-06-05 21:06:58] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.884938Z","level":"info","event":"📋 2025-06-05 21:06:58,876 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.885076Z","level":"info","event":"📋 [2025-06-05 21:06:58] ✅ Exportação concluída com sucesso. Processados 7 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.885247Z","level":"info","event":"📋 2025-06-05 21:06:58,877 - INFO - ✅ Exportação concluída com sucesso. Processados 7 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.983831Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.984119Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.984312Z","level":"info","event":"⚠️ export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_log_20250605.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.984423Z","level":"info","event":"✅ export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json (929 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.984511Z","level":"info","event":"✅ backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv (1909 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:06:58.984855","level":"info","event":"Done. Returned value was: [2025-06-05 21:06:58] A iniciar export_to_supabase_airflow\n2025-06-05 21:06:58,087 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-05 21:06:58] Parâmetros: date=2025-06-05\n2025-06-05 21:06:58,088 - INFO - Parâmetros: date=2025-06-05\n[2025-06-05 21:06:58] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05\n2025-06-05 21:06:58,088 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05\n[2025-06-05 21:06:58] 🚀 A iniciar exportação para Supabase para a data: 2025-06-05\n2025-06-05 21:06:58,088 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-05\n[2025-06-05 21:06:58] 📋 Tabela de destino: artigos_filtrados_20250605_staging\n2025-06-05 21:06:58,088 - INFO - 📋 Tabela de destino: artigos_filtrados_20250605_staging\n[2025-06-05 21:06:58] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05\n2025-06-05 21:06:58,088 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05\n[2025-06-05 21:06:58] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n2025-06-05 21:06:58,088 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n[2025-06-05 21:06:58] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n2025-06-05 21:06:58,088 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n[2025-06-05 21:06:58] 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-05 21:06:58,090 - INFO - 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-05 21:06:58] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-05 21:06:58,090 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-05 21:06:58] 🔍 Verificação inicial do ambiente...\n2025-06-05 21:06:58,090 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-05 21:06:58]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-05 21:06:58,090 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-05 21:06:58]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-05 21:06:58,090 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-05 21:06:58]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-05 21:06:58,090 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-05 21:06:58] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-05 21:06:58,090 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-05 21:06:58] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-05 21:06:58,091 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-05 21:06:58]   A verificar: /opt/airflow/.env\n2025-06-05 21:06:58,091 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-05 21:06:58]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-05 21:06:58,091 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-05 21:06:58]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-05 21:06:58,091 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-05 21:06:58] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-05 21:06:58,091 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-05 21:06:58] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-05 21:06:58,091 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-05 21:06:58]   ✅ Definido DB_USER do .env\n2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-05 21:06:58]   ✅ Definido DB_PASSWORD do .env\n2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-05 21:06:58]   ✅ Definido DB_HOST do .env\n2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-05 21:06:58]   ✅ Definido DB_PORT do .env\n2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-05 21:06:58]   ✅ Definido DB_NAME do .env\n2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-05 21:06:58]   ✅ Definido DB_SCHEMA do .env\n2025-06-05 21:06:58,091 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-05 21:06:58] 🔍 Verificação final da configuração...\n2025-06-05 21:06:58,091 - INFO - 🔍 Verificação final da configuração...\n[2025-06-05 21:06:58]   DB_HOST: DEFINIDO\n2025-06-05 21:06:58,091 - INFO -   DB_HOST: DEFINIDO\n[2025-06-05 21:06:58]   DB_USER: DEFINIDO\n2025-06-05 21:06:58,091 - INFO -   DB_USER: DEFINIDO\n[2025-06-05 21:06:58]   DB_PASSWORD: DEFINIDO\n2025-06-05 21:06:58,091 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-05 21:06:58]   DB_PORT: 6543\n2025-06-05 21:06:58,091 - INFO -   DB_PORT: 6543\n[2025-06-05 21:06:58]   DB_NAME: postgres\n2025-06-05 21:06:58,091 - INFO -   DB_NAME: postgres\n[2025-06-05 21:06:58]   DB_SCHEMA: google_scraper\n2025-06-05 21:06:58,091 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-05 21:06:58] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-05 21:06:58,091 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-05 21:06:58] 🔗 A conectar à base de dados...\n2025-06-05 21:06:58,091 - INFO - 🔗 A conectar à base de dados...\n[2025-06-05 21:06:58] ✅ Conectado à base de dados com sucesso\n2025-06-05 21:06:58,350 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-05 21:06:58] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia\n2025-06-05 21:06:58,398 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia\n[2025-06-05 21:06:58] ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto\n2025-06-05 21:06:58,453 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto\n[2025-06-05 21:06:58] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging\n2025-06-05 21:06:58,547 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging\n[2025-06-05 21:06:58] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-05 21:06:58,548 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-05 21:06:58] 📅 A converter formatos de data...\n2025-06-05 21:06:58,548 - INFO - 📅 A converter formatos de data...\n[2025-06-05 21:06:58] ✅ Preparadas 7 linhas para inserção\n2025-06-05 21:06:58,560 - INFO - ✅ Preparadas 7 linhas para inserção\n[2025-06-05 21:06:58] ✅ Inseridos/atualizados 7 artigos (falharam: 0)\n2025-06-05 21:06:58,867 - INFO - ✅ Inseridos/atualizados 7 artigos (falharam: 0)\n[2025-06-05 21:06:58] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n2025-06-05 21:06:58,874 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n[2025-06-05 21:06:58] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json\n2025-06-05 21:06:58,876 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json\n[2025-06-05 21:06:58] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n2025-06-05 21:06:58,876 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n[2025-06-05 21:06:58] ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging\n2025-06-05 21:06:58,876 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging\n[2025-06-05 21:06:58] 🔗 Ligação à base de dados fechada\n2025-06-05 21:06:58,876 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-05 21:06:58] ✅ Exportação concluída com sucesso. Processados 7 artigos\n2025-06-05 21:06:58,877 - INFO - ✅ Exportação concluída com sucesso. Processados 7 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
