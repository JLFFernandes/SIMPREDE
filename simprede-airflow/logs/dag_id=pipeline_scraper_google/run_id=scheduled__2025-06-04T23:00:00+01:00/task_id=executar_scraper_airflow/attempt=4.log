{"timestamp":"2025-06-05T21:12:36.143478","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-05T21:12:36.144601","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-05T21:12:36.215088Z","level":"info","event":"🚀 Starting Airflow-Optimized Google News Scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.215248Z","level":"info","event":"📅 Using current date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.215376Z","level":"info","event":"📅 Using current date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.215586Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/05', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/05', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/05']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.215661Z","level":"info","event":"📅 Scraper Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.215723Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.215814Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.216125Z","level":"info","event":"  - Max execution time: 3600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.216297Z","level":"info","event":"  - Target date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.216374Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.216456Z","level":"info","event":"  - intermediate_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.216569Z","level":"info","event":"  - final_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/google_news_articles_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.216657Z","level":"info","event":"  - log_file: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_log_20250605.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.216725Z","level":"info","event":"  - stats_json: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.217768Z","level":"info","event":"🔄 Running scraper command: python /opt/airflow/scripts/google_scraper/scraping/run_scraper_airflow.py --dias 1 --max_time 3600 --output_dir /opt/airflow/scripts/google_scraper/data/raw/2025/06/05 --date_str 20250605 --date 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.218650Z","level":"info","event":"⏰ Waiting for scraper completion with timeout: 3600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.623124Z","level":"info","event":"📋 A iniciar scraper do Google News (versão Airflow)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.623338Z","level":"info","event":"📋 Parâmetros: dias=1, date=2025-06-05, max_time=3600","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.623426Z","level":"info","event":"📋 Paths: output_dir=/opt/airflow/scripts/google_scraper/data/raw/2025/06/05, date_str=20250605","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.626091Z","level":"info","event":"📋 📁 A usar ficheiro de saída controlado: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.626240Z","level":"info","event":"📋 ⏱️ Tempo máximo de execução: 3600 segundos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.628588Z","level":"info","event":"📋 🚀 A iniciar função do scraper otimizada para Airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.628692Z","level":"info","event":"📋 ⚙️  Parâmetros: days_back=1, search_date=2025-06-05, max_time=3600s","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.628754Z","level":"info","event":"📋 📁 Diretoria de saída: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.628807Z","level":"info","event":"📋 📅 String de data: 20250605","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.628854Z","level":"info","event":"📋 🚀 A iniciar o scraper do Google News...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.628916Z","level":"info","event":"📋 📅 Data: 2025-06-05, Dias anteriores: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.628965Z","level":"info","event":"📋 📁 Diretoria de saída controlada: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.629092Z","level":"info","event":"📋 📅 String de data: 20250605","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.778404Z","level":"info","event":"📋 📁 Diretoria do script: /opt/airflow/scripts/google_scraper/scraping","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.778791Z","level":"info","event":"📋 📁 Raiz do projeto: /opt/airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:36.779117Z","level":"info","event":"📋 🔧 A carregar ficheiros de configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.015996Z","level":"info","event":"📋 🔍 A procurar ficheiros de configuração em: ['/opt/airflow/config', '/opt/airflow/simprede-airflow/config', '/opt/airflow/scripts/google_scraper/scraping/../../../config', '/opt/airflow/scripts/google_scraper/scraping/../config', '/opt/airflow/scripts/google_scraper/scraping/config', '/opt/airflow/config', '/opt/airflow/simprede-airflow/config', 'config']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.016558Z","level":"info","event":"📋 📁 A carregar palavras-chave de: /opt/airflow/scripts/google_scraper/scraping/../config/keywords.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.016828Z","level":"info","event":"📋 ✅ Carregadas 6 palavras-chave","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.016938Z","level":"info","event":"📋 📁 A carregar localizações de: /opt/airflow/scripts/google_scraper/scraping/../config/municipios_por_distrito.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.018013Z","level":"info","event":"📋 ✅ Carregadas 306 freguesias, 306 municípios, 29 distritos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.020915Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.021590Z","level":"info","event":"📋 Configuração Carregada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.022162Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.022516Z","level":"info","event":"📋   Palavras-chave: 6","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.022831Z","level":"info","event":"📋   Total de Localizações: 641","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.023251Z","level":"info","event":"📋   Freguesias: 306","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.024022Z","level":"info","event":"📋   Municípios: 306","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.024571Z","level":"info","event":"📋   Distritos: 29","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.025362Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.056231Z","level":"info","event":"📋 🧹 Cache limpa","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.058603Z","level":"info","event":"📋 📅 A usar data específica: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.058823Z","level":"info","event":"📋 📁 Diretoria de saída: /opt/airflow/data/raw/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059193Z","level":"info","event":"📋 🔄 A gerar combinações palavra-chave-localização...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059339Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059418Z","level":"info","event":"📋 Combinações Geradas","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059482Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059582Z","level":"info","event":"📋   Total de Combinações: 3846","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059667Z","level":"info","event":"📋   Palavras-chave: 6","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059740Z","level":"info","event":"📋   Localizações: 641","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059828Z","level":"info","event":"📋   Palavras-chave Prioritárias: 5","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.059928Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060049Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060154Z","level":"info","event":"📋 Configuração de Processamento","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060245Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060324Z","level":"info","event":"📋   Total de Combinações: 3846","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060405Z","level":"info","event":"📋   Tamanho do Lote: 300","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060484Z","level":"info","event":"📋   Lotes Estimados: 13","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060632Z","level":"info","event":"📋   Máx. Pedidos Concorrentes: 180","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060704Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060803Z","level":"info","event":"📋 🔗 A configurar sessão HTTP equilibrada...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:38.060874Z","level":"info","event":"📋 🔍 A verificar acesso ao feed RSS do Google News...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.593613Z","level":"info","event":"📋 2025-06-05 22:12:46,592 - run_scraper_airflow - ERROR - ❌ Não foi possível aceder ao Google News: estado HTTP 503","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.595723Z","level":"info","event":"📋 2025-06-05 22:12:46,593 - run_scraper_airflow - ERROR - 🛑 Não é possível continuar com o scraping pois o Google News não está acessível","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.596442Z","level":"info","event":"📋 🎉 Execução do Airflow concluída com sucesso! Artigos: 0","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.597255Z","level":"info","event":"📋 ✅ Scraping concluído. Guardados 0 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.815371Z","level":"info","event":"✅ Scraper completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.815826Z","level":"info","event":"🔍 Verifying scraper outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.816118Z","level":"info","event":"✅ intermediate_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv (255935 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:46.816426Z","level":"info","event":"✅ final_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/google_news_articles_20250605.csv (5342 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:47.873174Z","level":"info","event":"📊 Number of articles scraped: 12","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:47.873428Z","level":"info","event":"📊 Columns: ['ID', 'keyword', 'localidade', 'title', 'link', 'published', 'collection_date']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:47.874434Z","level":"info","event":"⚠️ log_file: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_log_20250605.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:47.874588Z","level":"info","event":"⚠️ stats_json: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_stats_20250605.json (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T21:12:47.873848","level":"info","event":"Done. Returned value was: A iniciar scraper do Google News (versão Airflow)\nParâmetros: dias=1, date=2025-06-05, max_time=3600\nPaths: output_dir=/opt/airflow/scripts/google_scraper/data/raw/2025/06/05, date_str=20250605\n📁 A usar ficheiro de saída controlado: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv\n⏱️ Tempo máximo de execução: 3600 segundos\n🚀 A iniciar função do scraper otimizada para Airflow\n⚙️  Parâmetros: days_back=1, search_date=2025-06-05, max_time=3600s\n📁 Diretoria de saída: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05\n📅 String de data: 20250605\n🚀 A iniciar o scraper do Google News...\n📅 Data: 2025-06-05, Dias anteriores: 1\n📁 Diretoria de saída controlada: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05\n📅 String de data: 20250605\n📁 Diretoria do script: /opt/airflow/scripts/google_scraper/scraping\n📁 Raiz do projeto: /opt/airflow\n🔧 A carregar ficheiros de configuração...\n🔍 A procurar ficheiros de configuração em: ['/opt/airflow/config', '/opt/airflow/simprede-airflow/config', '/opt/airflow/scripts/google_scraper/scraping/../../../config', '/opt/airflow/scripts/google_scraper/scraping/../config', '/opt/airflow/scripts/google_scraper/scraping/config', '/opt/airflow/config', '/opt/airflow/simprede-airflow/config', 'config']\n📁 A carregar palavras-chave de: /opt/airflow/scripts/google_scraper/scraping/../config/keywords.json\n✅ Carregadas 6 palavras-chave\n📁 A carregar localizações de: /opt/airflow/scripts/google_scraper/scraping/../config/municipios_por_distrito.json\n✅ Carregadas 306 freguesias, 306 municípios, 29 distritos\n==================================================\nConfiguração Carregada\n==================================================\n  Palavras-chave: 6\n  Total de Localizações: 641\n  Freguesias: 306\n  Municípios: 306\n  Distritos: 29\n==================================================\n🧹 Cache limpa\n📅 A usar data específica: 2025-06-05\n📁 Diretoria de saída: /opt/airflow/data/raw/2025/06/05\n🔄 A gerar combinações palavra-chave-localização...\n==================================================\nCombinações Geradas\n==================================================\n  Total de Combinações: 3846\n  Palavras-chave: 6\n  Localizações: 641\n  Palavras-chave Prioritárias: 5\n==================================================\n==================================================\nConfiguração de Processamento\n==================================================\n  Total de Combinações: 3846\n  Tamanho do Lote: 300\n  Lotes Estimados: 13\n  Máx. Pedidos Concorrentes: 180\n==================================================\n🔗 A configurar sessão HTTP equilibrada...\n🔍 A verificar acesso ao feed RSS do Google News...\n2025-06-05 22:12:46,592 - run_scraper_airflow - ERROR - ❌ Não foi possível aceder ao Google News: estado HTTP 503\n2025-06-05 22:12:46,593 - run_scraper_airflow - ERROR - 🛑 Não é possível continuar com o scraping pois o Google News não está acessível\n🎉 Execução do Airflow concluída com sucesso! Artigos: 0\n✅ Scraping concluído. Guardados 0 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
