{"timestamp":"2025-06-05T20:07:24.925529","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-05T20:07:24.925859","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-05T20:07:24.964135Z","level":"info","event":"🚀 Starting Airflow-Optimized Google News Scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.964342Z","level":"info","event":"📅 Using current date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.964452Z","level":"info","event":"📅 Using current date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.964528Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/05', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/05', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/05']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.964607Z","level":"info","event":"📅 Scraper Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.964813Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.965096Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.965219Z","level":"info","event":"  - Max execution time: 3600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.965295Z","level":"info","event":"  - Target date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.965386Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.965471Z","level":"info","event":"  - intermediate_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.965629Z","level":"info","event":"  - final_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/google_news_articles_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.965725Z","level":"info","event":"  - log_file: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_log_20250605.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.966554Z","level":"info","event":"  - stats_json: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.968529Z","level":"info","event":"🔄 Running scraper command: python /opt/airflow/scripts/google_scraper/scraping/run_scraper_airflow.py --dias 1 --max_time 3600 --output_dir /opt/airflow/scripts/google_scraper/data/raw/2025/06/05 --date_str 20250605 --date 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:24.968601Z","level":"info","event":"⏰ Waiting for scraper completion with timeout: 3600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.303053Z","level":"info","event":"📋 A iniciar scraper do Google News (versão Airflow)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.303304Z","level":"info","event":"📋 Parâmetros: dias=1, date=2025-06-05, max_time=3600","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.303375Z","level":"info","event":"📋 Paths: output_dir=/opt/airflow/scripts/google_scraper/data/raw/2025/06/05, date_str=20250605","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.305287Z","level":"info","event":"📋 📁 A usar ficheiro de saída controlado: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.305362Z","level":"info","event":"📋 ⏱️ Tempo máximo de execução: 3600 segundos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.305604Z","level":"info","event":"📋 🚀 A iniciar função do scraper otimizada para Airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.305665Z","level":"info","event":"📋 ⚙️  Parâmetros: days_back=1, search_date=2025-06-05, max_time=3600s","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.305773Z","level":"info","event":"📋 📁 Diretoria de saída: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.305943Z","level":"info","event":"📋 📅 String de data: 20250605","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.306088Z","level":"info","event":"📋 🚀 A iniciar o scraper do Google News...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.306185Z","level":"info","event":"📋 📅 Data: 2025-06-05, Dias anteriores: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.306274Z","level":"info","event":"📋 📁 Diretoria de saída controlada: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.306370Z","level":"info","event":"📋 📅 String de data: 20250605","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.425685Z","level":"info","event":"📋 📁 Diretoria do script: /opt/airflow/scripts/google_scraper/scraping","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.425865Z","level":"info","event":"📋 📁 Raiz do projeto: /opt/airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:25.426135Z","level":"info","event":"📋 🔧 A carregar ficheiros de configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.428041Z","level":"info","event":"📋 🔍 A procurar ficheiros de configuração em: ['/opt/airflow/config', '/opt/airflow/simprede-airflow/config', '/opt/airflow/scripts/google_scraper/scraping/../../../config', '/opt/airflow/scripts/google_scraper/scraping/../config', '/opt/airflow/scripts/google_scraper/scraping/config', '/opt/airflow/config', '/opt/airflow/simprede-airflow/config', 'config']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.428411Z","level":"info","event":"📋 📁 A carregar palavras-chave de: /opt/airflow/scripts/google_scraper/scraping/../config/keywords.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.428708Z","level":"info","event":"📋 ✅ Carregadas 6 palavras-chave","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.428804Z","level":"info","event":"📋 📁 A carregar localizações de: /opt/airflow/scripts/google_scraper/scraping/../config/municipios_por_distrito.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429544Z","level":"info","event":"📋 ✅ Carregadas 306 freguesias, 306 municípios, 29 distritos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429607Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429658Z","level":"info","event":"📋 Configuração Carregada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429707Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429778Z","level":"info","event":"📋   Palavras-chave: 6","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429832Z","level":"info","event":"📋   Total de Localizações: 641","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429880Z","level":"info","event":"📋   Freguesias: 306","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429928Z","level":"info","event":"📋   Municípios: 306","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.429978Z","level":"info","event":"📋   Distritos: 29","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.430025Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.460258Z","level":"info","event":"📋 🧹 Cache limpa","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.460548Z","level":"info","event":"📋 📅 A usar data específica: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.461796Z","level":"info","event":"📋 📁 Diretoria de saída: /opt/airflow/data/raw/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.461981Z","level":"info","event":"📋 🔄 A gerar combinações palavra-chave-localização...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.463370Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.463547Z","level":"info","event":"📋 Combinações Geradas","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.463975Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464176Z","level":"info","event":"📋   Total de Combinações: 3846","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464244Z","level":"info","event":"📋   Palavras-chave: 6","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464308Z","level":"info","event":"📋   Localizações: 641","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464383Z","level":"info","event":"📋   Palavras-chave Prioritárias: 5","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464443Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464538Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464610Z","level":"info","event":"📋 Configuração de Processamento","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464668Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464719Z","level":"info","event":"📋   Total de Combinações: 3846","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464766Z","level":"info","event":"📋   Tamanho do Lote: 300","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464813Z","level":"info","event":"📋   Lotes Estimados: 13","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464857Z","level":"info","event":"📋   Máx. Pedidos Concorrentes: 180","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.464930Z","level":"info","event":"📋 ==================================================","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.465017Z","level":"info","event":"📋 🔗 A configurar sessão HTTP equilibrada...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:26.465103Z","level":"info","event":"📋 🔍 A verificar acesso ao feed RSS do Google News...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.801439Z","level":"info","event":"📋 2025-06-05 21:07:35,801 - run_scraper_airflow - ERROR - ❌ Não foi possível aceder ao Google News: estado HTTP 503","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.802000Z","level":"info","event":"📋 2025-06-05 21:07:35,801 - run_scraper_airflow - ERROR - 🛑 Não é possível continuar com o scraping pois o Google News não está acessível","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.802619Z","level":"info","event":"📋 🎉 Execução do Airflow concluída com sucesso! Artigos: 0","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.802816Z","level":"info","event":"📋 ✅ Scraping concluído. Guardados 0 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.930012Z","level":"info","event":"✅ Scraper completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.930224Z","level":"info","event":"🔍 Verifying scraper outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.930386Z","level":"info","event":"✅ intermediate_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv (255935 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:35.930484Z","level":"info","event":"✅ final_csv: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/google_news_articles_20250605.csv (5342 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:36.636890Z","level":"info","event":"📊 Number of articles scraped: 12","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:36.637084Z","level":"info","event":"📊 Columns: ['ID', 'keyword', 'localidade', 'title', 'link', 'published', 'collection_date']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:36.649745Z","level":"info","event":"⚠️ log_file: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_log_20250605.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:36.649867Z","level":"info","event":"⚠️ stats_json: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/scraper_stats_20250605.json (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T20:07:36.637399","level":"info","event":"Done. Returned value was: A iniciar scraper do Google News (versão Airflow)\nParâmetros: dias=1, date=2025-06-05, max_time=3600\nPaths: output_dir=/opt/airflow/scripts/google_scraper/data/raw/2025/06/05, date_str=20250605\n📁 A usar ficheiro de saída controlado: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05/intermediate_google_news_20250605.csv\n⏱️ Tempo máximo de execução: 3600 segundos\n🚀 A iniciar função do scraper otimizada para Airflow\n⚙️  Parâmetros: days_back=1, search_date=2025-06-05, max_time=3600s\n📁 Diretoria de saída: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05\n📅 String de data: 20250605\n🚀 A iniciar o scraper do Google News...\n📅 Data: 2025-06-05, Dias anteriores: 1\n📁 Diretoria de saída controlada: /opt/airflow/scripts/google_scraper/data/raw/2025/06/05\n📅 String de data: 20250605\n📁 Diretoria do script: /opt/airflow/scripts/google_scraper/scraping\n📁 Raiz do projeto: /opt/airflow\n🔧 A carregar ficheiros de configuração...\n🔍 A procurar ficheiros de configuração em: ['/opt/airflow/config', '/opt/airflow/simprede-airflow/config', '/opt/airflow/scripts/google_scraper/scraping/../../../config', '/opt/airflow/scripts/google_scraper/scraping/../config', '/opt/airflow/scripts/google_scraper/scraping/config', '/opt/airflow/config', '/opt/airflow/simprede-airflow/config', 'config']\n📁 A carregar palavras-chave de: /opt/airflow/scripts/google_scraper/scraping/../config/keywords.json\n✅ Carregadas 6 palavras-chave\n📁 A carregar localizações de: /opt/airflow/scripts/google_scraper/scraping/../config/municipios_por_distrito.json\n✅ Carregadas 306 freguesias, 306 municípios, 29 distritos\n==================================================\nConfiguração Carregada\n==================================================\n  Palavras-chave: 6\n  Total de Localizações: 641\n  Freguesias: 306\n  Municípios: 306\n  Distritos: 29\n==================================================\n🧹 Cache limpa\n📅 A usar data específica: 2025-06-05\n📁 Diretoria de saída: /opt/airflow/data/raw/2025/06/05\n🔄 A gerar combinações palavra-chave-localização...\n==================================================\nCombinações Geradas\n==================================================\n  Total de Combinações: 3846\n  Palavras-chave: 6\n  Localizações: 641\n  Palavras-chave Prioritárias: 5\n==================================================\n==================================================\nConfiguração de Processamento\n==================================================\n  Total de Combinações: 3846\n  Tamanho do Lote: 300\n  Lotes Estimados: 13\n  Máx. Pedidos Concorrentes: 180\n==================================================\n🔗 A configurar sessão HTTP equilibrada...\n🔍 A verificar acesso ao feed RSS do Google News...\n2025-06-05 21:07:35,801 - run_scraper_airflow - ERROR - ❌ Não foi possível aceder ao Google News: estado HTTP 503\n2025-06-05 21:07:35,801 - run_scraper_airflow - ERROR - 🛑 Não é possível continuar com o scraping pois o Google News não está acessível\n🎉 Execução do Airflow concluída com sucesso! Artigos: 0\n✅ Scraping concluído. Guardados 0 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
