{"timestamp":"2025-06-09T08:27:20.320293","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-09T08:27:20.320821","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-09T08:27:20.352423Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.352668Z","level":"info","event":"📅 Using current date: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.353015Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/data/raw/2025/06/09', '/opt/airflow/data/structured/2025/06/09', '/opt/airflow/data/processed/2025/06/09']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.353198Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.353268Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.353332Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.353394Z","level":"info","event":"  - Target date: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.353452Z","level":"info","event":"  - Database table: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.353513Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.363710Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.363850Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/09/artigos_vitimas_filtrados_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.364476Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/09/artigos_sem_vitimas_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.364620Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365012Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (4353 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365209Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365309Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (4353 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365422Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/processing_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365524Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/processing_stats_20250609.json (395 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365633Z","level":"info","event":"📋 Selected input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (4353 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365732Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365841Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.365951Z","level":"info","event":"  - export_log: /opt/airflow/data/processed/2025/06/09/export_log_20250609.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.366143Z","level":"info","event":"  - export_stats: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.366238Z","level":"info","event":"  - backup_csv: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.366330Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/data/processed/2025/06/09 --date_str 2025-06-09 --input_file /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv --date 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:20.366442Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.756006Z","level":"info","event":"📋 [2025-06-09 09:27:21] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.756383Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.757916Z","level":"info","event":"📋 [2025-06-09 09:27:21] Parâmetros: date=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758027Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - Parâmetros: date=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758121Z","level":"info","event":"📋 [2025-06-09 09:27:21] Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758207Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758284Z","level":"info","event":"📋 [2025-06-09 09:27:21] 🚀 A iniciar exportação para Supabase para a data: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758356Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758429Z","level":"info","event":"📋 [2025-06-09 09:27:21] 📋 Tabela de destino: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758497Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - 📋 Tabela de destino: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758572Z","level":"info","event":"📋 [2025-06-09 09:27:21] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758641Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758710Z","level":"info","event":"📋 [2025-06-09 09:27:21] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758781Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758847Z","level":"info","event":"📋 [2025-06-09 09:27:21] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.758981Z","level":"info","event":"📋 2025-06-09 09:27:21,755 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759117Z","level":"info","event":"📋 [2025-06-09 09:27:21] 📊 Carregados 17 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759193Z","level":"info","event":"📋 2025-06-09 09:27:21,758 - INFO - 📊 Carregados 17 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759262Z","level":"info","event":"📋 [2025-06-09 09:27:21] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759331Z","level":"info","event":"📋 2025-06-09 09:27:21,758 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759399Z","level":"info","event":"📋 [2025-06-09 09:27:21] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759483Z","level":"info","event":"📋 2025-06-09 09:27:21,758 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759551Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759615Z","level":"info","event":"📋 2025-06-09 09:27:21,759 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759696Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759771Z","level":"info","event":"📋 2025-06-09 09:27:21,759 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759894Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.759963Z","level":"info","event":"📋 2025-06-09 09:27:21,759 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.760235Z","level":"info","event":"📋 [2025-06-09 09:27:21] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.760385Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.760478Z","level":"info","event":"📋 [2025-06-09 09:27:21] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.760781Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.761078Z","level":"info","event":"📋 [2025-06-09 09:27:21]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.761149Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.761274Z","level":"info","event":"📋 [2025-06-09 09:27:21]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.761956Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.762139Z","level":"info","event":"📋 [2025-06-09 09:27:21]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.762347Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.762537Z","level":"info","event":"📋 [2025-06-09 09:27:21] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.762643Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.762814Z","level":"info","event":"📋 [2025-06-09 09:27:21] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.762944Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763045Z","level":"info","event":"📋 [2025-06-09 09:27:21]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763368Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763479Z","level":"info","event":"📋 [2025-06-09 09:27:21]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763555Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763616Z","level":"info","event":"📋 [2025-06-09 09:27:21]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763678Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763737Z","level":"info","event":"📋 [2025-06-09 09:27:21]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763794Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763851Z","level":"info","event":"📋 [2025-06-09 09:27:21]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763908Z","level":"info","event":"📋 2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.763966Z","level":"info","event":"📋 [2025-06-09 09:27:21]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764022Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764091Z","level":"info","event":"📋 [2025-06-09 09:27:21] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764163Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764219Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764324Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764381Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764438Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764493Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764553Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764612Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764670Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764727Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764783Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764844Z","level":"info","event":"📋 [2025-06-09 09:27:21]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764900Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.764956Z","level":"info","event":"📋 [2025-06-09 09:27:21] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.765012Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.765070Z","level":"info","event":"📋 [2025-06-09 09:27:21] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:21.765129Z","level":"info","event":"📋 2025-06-09 09:27:21,761 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.048412Z","level":"info","event":"📋 [2025-06-09 09:27:22] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.049329Z","level":"info","event":"📋 2025-06-09 09:27:22,048 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.102503Z","level":"info","event":"📋 [2025-06-09 09:27:22] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.102859Z","level":"info","event":"📋 2025-06-09 09:27:22,102 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.234821Z","level":"info","event":"📋 [2025-06-09 09:27:22] ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.235513Z","level":"info","event":"📋 2025-06-09 09:27:22,234 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.321735Z","level":"info","event":"📋 [2025-06-09 09:27:22] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.325887Z","level":"info","event":"📋 2025-06-09 09:27:22,321 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.326120Z","level":"info","event":"📋 [2025-06-09 09:27:22] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.326229Z","level":"info","event":"📋 2025-06-09 09:27:22,321 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.326344Z","level":"info","event":"📋 [2025-06-09 09:27:22] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.326438Z","level":"info","event":"📋 2025-06-09 09:27:22,322 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.326533Z","level":"info","event":"📋 [2025-06-09 09:27:22] ✅ Preparadas 17 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:22.326622Z","level":"info","event":"📋 2025-06-09 09:27:22,325 - INFO - ✅ Preparadas 17 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.035819Z","level":"info","event":"📋 [2025-06-09 09:27:23] ✅ Inseridos/atualizados 17 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.036642Z","level":"info","event":"📋 2025-06-09 09:27:23,035 - INFO - ✅ Inseridos/atualizados 17 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.043016Z","level":"info","event":"📋 [2025-06-09 09:27:23] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.043536Z","level":"info","event":"📋 2025-06-09 09:27:23,042 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.044731Z","level":"info","event":"📋 [2025-06-09 09:27:23] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.051256Z","level":"info","event":"📋 2025-06-09 09:27:23,044 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.052194Z","level":"info","event":"📋 [2025-06-09 09:27:23] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.053169Z","level":"info","event":"📋 2025-06-09 09:27:23,044 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.054313Z","level":"info","event":"📋 [2025-06-09 09:27:23] ✅ Exportação concluída com sucesso. Inseridos/atualizados 17 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.054522Z","level":"info","event":"📋 2025-06-09 09:27:23,044 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 17 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.054714Z","level":"info","event":"📋 [2025-06-09 09:27:23] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.054823Z","level":"info","event":"📋 2025-06-09 09:27:23,044 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.054921Z","level":"info","event":"📋 [2025-06-09 09:27:23] ✅ Exportação concluída com sucesso. Processados 17 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.055115Z","level":"info","event":"📋 2025-06-09 09:27:23,044 - INFO - ✅ Exportação concluída com sucesso. Processados 17 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.158775Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.159025Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.159267Z","level":"info","event":"⚠️ export_log: /opt/airflow/data/processed/2025/06/09/export_log_20250609.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.159407Z","level":"info","event":"✅ export_stats: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json (885 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.159540Z","level":"info","event":"✅ backup_csv: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv (4344 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:27:23.160013","level":"info","event":"Done. Returned value was: [2025-06-09 09:27:21] A iniciar export_to_supabase_airflow\n2025-06-09 09:27:21,755 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-09 09:27:21] Parâmetros: date=2025-06-09\n2025-06-09 09:27:21,755 - INFO - Parâmetros: date=2025-06-09\n[2025-06-09 09:27:21] Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09\n2025-06-09 09:27:21,755 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09\n[2025-06-09 09:27:21] 🚀 A iniciar exportação para Supabase para a data: 2025-06-09\n2025-06-09 09:27:21,755 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-09\n[2025-06-09 09:27:21] 📋 Tabela de destino: artigos_filtrados_20250609_staging\n2025-06-09 09:27:21,755 - INFO - 📋 Tabela de destino: artigos_filtrados_20250609_staging\n[2025-06-09 09:27:21] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09\n2025-06-09 09:27:21,755 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09\n[2025-06-09 09:27:21] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n2025-06-09 09:27:21,755 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n[2025-06-09 09:27:21] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n2025-06-09 09:27:21,755 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n[2025-06-09 09:27:21] 📊 Carregados 17 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-09 09:27:21,758 - INFO - 📊 Carregados 17 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-09 09:27:21] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-09 09:27:21,758 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-09 09:27:21] 🔍 Verificação inicial do ambiente...\n2025-06-09 09:27:21,758 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-09 09:27:21]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-09 09:27:21,759 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-09 09:27:21]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-09 09:27:21,759 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-09 09:27:21]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-09 09:27:21,759 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-09 09:27:21] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-09 09:27:21,760 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-09 09:27:21] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-09 09:27:21,760 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-09 09:27:21]   A verificar: /opt/airflow/.env\n2025-06-09 09:27:21,760 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-09 09:27:21]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-09 09:27:21,760 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-09 09:27:21]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-09 09:27:21,760 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-09 09:27:21] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-09 09:27:21,760 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-09 09:27:21] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-09 09:27:21,760 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-09 09:27:21]   ✅ Definido DB_USER do .env\n2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-09 09:27:21]   ✅ Definido DB_PASSWORD do .env\n2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-09 09:27:21]   ✅ Definido DB_HOST do .env\n2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-09 09:27:21]   ✅ Definido DB_PORT do .env\n2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-09 09:27:21]   ✅ Definido DB_NAME do .env\n2025-06-09 09:27:21,760 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-09 09:27:21]   ✅ Definido DB_SCHEMA do .env\n2025-06-09 09:27:21,761 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-09 09:27:21] 🔍 Verificação final da configuração...\n2025-06-09 09:27:21,761 - INFO - 🔍 Verificação final da configuração...\n[2025-06-09 09:27:21]   DB_HOST: DEFINIDO\n2025-06-09 09:27:21,761 - INFO -   DB_HOST: DEFINIDO\n[2025-06-09 09:27:21]   DB_USER: DEFINIDO\n2025-06-09 09:27:21,761 - INFO -   DB_USER: DEFINIDO\n[2025-06-09 09:27:21]   DB_PASSWORD: DEFINIDO\n2025-06-09 09:27:21,761 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-09 09:27:21]   DB_PORT: 6543\n2025-06-09 09:27:21,761 - INFO -   DB_PORT: 6543\n[2025-06-09 09:27:21]   DB_NAME: postgres\n2025-06-09 09:27:21,761 - INFO -   DB_NAME: postgres\n[2025-06-09 09:27:21]   DB_SCHEMA: google_scraper\n2025-06-09 09:27:21,761 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-09 09:27:21] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-09 09:27:21,761 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-09 09:27:21] 🔗 A conectar à base de dados...\n2025-06-09 09:27:21,761 - INFO - 🔗 A conectar à base de dados...\n[2025-06-09 09:27:22] ✅ Conectado à base de dados com sucesso\n2025-06-09 09:27:22,048 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-09 09:27:22] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia\n2025-06-09 09:27:22,102 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia\n[2025-06-09 09:27:22] ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto\n2025-06-09 09:27:22,234 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto\n[2025-06-09 09:27:22] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging\n2025-06-09 09:27:22,321 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging\n[2025-06-09 09:27:22] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-09 09:27:22,321 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-09 09:27:22] 📅 A converter formatos de data...\n2025-06-09 09:27:22,322 - INFO - 📅 A converter formatos de data...\n[2025-06-09 09:27:22] ✅ Preparadas 17 linhas para inserção\n2025-06-09 09:27:22,325 - INFO - ✅ Preparadas 17 linhas para inserção\n[2025-06-09 09:27:23] ✅ Inseridos/atualizados 17 artigos (falharam: 0)\n2025-06-09 09:27:23,035 - INFO - ✅ Inseridos/atualizados 17 artigos (falharam: 0)\n[2025-06-09 09:27:23] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n2025-06-09 09:27:23,042 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n[2025-06-09 09:27:23] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json\n2025-06-09 09:27:23,044 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json\n[2025-06-09 09:27:23] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n2025-06-09 09:27:23,044 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n[2025-06-09 09:27:23] ✅ Exportação concluída com sucesso. Inseridos/atualizados 17 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging\n2025-06-09 09:27:23,044 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 17 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging\n[2025-06-09 09:27:23] 🔗 Ligação à base de dados fechada\n2025-06-09 09:27:23,044 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-09 09:27:23] ✅ Exportação concluída com sucesso. Processados 17 artigos\n2025-06-09 09:27:23,044 - INFO - ✅ Exportação concluída com sucesso. Processados 17 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
{"timestamp":"2025-06-09T19:37:26.184441","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-09T19:37:26.184702","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-09T19:37:26.210860Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211069Z","level":"info","event":"📅 Using current date: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211531Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/data/raw/2025/06/09', '/opt/airflow/data/structured/2025/06/09', '/opt/airflow/data/processed/2025/06/09']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211601Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211799Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211852Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211899Z","level":"info","event":"  - Target date: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211939Z","level":"info","event":"  - Database table: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.211976Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.217719Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218157Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/09/artigos_vitimas_filtrados_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218235Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/09/artigos_sem_vitimas_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218404Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218496Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (2439 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218558Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218604Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (2439 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218648Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/processing_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218690Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/processing_stats_20250609.json (393 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218733Z","level":"info","event":"📋 Selected input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (2439 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218782Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218841Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218913Z","level":"info","event":"  - export_log: /opt/airflow/data/processed/2025/06/09/export_log_20250609.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218957Z","level":"info","event":"  - export_stats: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.218997Z","level":"info","event":"  - backup_csv: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.219035Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/data/processed/2025/06/09 --date_str 2025-06-09 --input_file /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv --date 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:26.219091Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.156168Z","level":"info","event":"📋 [2025-06-09 20:37:27] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.156778Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.156865Z","level":"info","event":"📋 [2025-06-09 20:37:27] Parâmetros: date=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.156917Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - Parâmetros: date=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.156963Z","level":"info","event":"📋 [2025-06-09 20:37:27] Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.157043Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.157091Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🚀 A iniciar exportação para Supabase para a data: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.157134Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.157183Z","level":"info","event":"📋 [2025-06-09 20:37:27] 📋 Tabela de destino: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.157229Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - 📋 Tabela de destino: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.157336Z","level":"info","event":"📋 [2025-06-09 20:37:27] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.157382Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158418Z","level":"info","event":"📋 [2025-06-09 20:37:27] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158479Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158524Z","level":"info","event":"📋 [2025-06-09 20:37:27] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158567Z","level":"info","event":"📋 2025-06-09 20:37:27,156 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158686Z","level":"info","event":"📋 [2025-06-09 20:37:27] 📊 Carregados 9 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158800Z","level":"info","event":"📋 2025-06-09 20:37:27,158 - INFO - 📊 Carregados 9 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158849Z","level":"info","event":"📋 [2025-06-09 20:37:27] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.158931Z","level":"info","event":"📋 2025-06-09 20:37:27,158 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159023Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159114Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159158Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159244Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159289Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159364Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159408Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159487Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159530Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159610Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159714Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159795Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159838Z","level":"info","event":"📋 [2025-06-09 20:37:27]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159917Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.159996Z","level":"info","event":"📋 [2025-06-09 20:37:27]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160100Z","level":"info","event":"📋 2025-06-09 20:37:27,159 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160158Z","level":"info","event":"📋 [2025-06-09 20:37:27]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160237Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160304Z","level":"info","event":"📋 [2025-06-09 20:37:27] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160631Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160690Z","level":"info","event":"📋 [2025-06-09 20:37:27] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160747Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160790Z","level":"info","event":"📋 [2025-06-09 20:37:27]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.160860Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.161381Z","level":"info","event":"📋 [2025-06-09 20:37:27]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.161466Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.161554Z","level":"info","event":"📋 [2025-06-09 20:37:27]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.161637Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.161718Z","level":"info","event":"📋 [2025-06-09 20:37:27]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.161833Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.161944Z","level":"info","event":"📋 [2025-06-09 20:37:27]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.162079Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.162209Z","level":"info","event":"📋 [2025-06-09 20:37:27]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.162325Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.162496Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.162579Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.162670Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.162757Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164505Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164590Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164648Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164698Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164756Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164811Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164867Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164916Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.164972Z","level":"info","event":"📋 [2025-06-09 20:37:27]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.165033Z","level":"info","event":"📋 2025-06-09 20:37:27,160 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.165114Z","level":"info","event":"📋 [2025-06-09 20:37:27] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.165156Z","level":"info","event":"📋 2025-06-09 20:37:27,161 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.165197Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.165238Z","level":"info","event":"📋 2025-06-09 20:37:27,161 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.423051Z","level":"info","event":"📋 [2025-06-09 20:37:27] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.423873Z","level":"info","event":"📋 2025-06-09 20:37:27,422 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.482399Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.482895Z","level":"info","event":"📋 2025-06-09 20:37:27,482 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.565222Z","level":"info","event":"📋 [2025-06-09 20:37:27] ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.565639Z","level":"info","event":"📋 2025-06-09 20:37:27,565 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.647150Z","level":"info","event":"📋 [2025-06-09 20:37:27] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.649894Z","level":"info","event":"📋 2025-06-09 20:37:27,647 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.651857Z","level":"info","event":"📋 [2025-06-09 20:37:27] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.653102Z","level":"info","event":"📋 2025-06-09 20:37:27,647 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.654247Z","level":"info","event":"📋 [2025-06-09 20:37:27] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.654428Z","level":"info","event":"📋 2025-06-09 20:37:27,647 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.654611Z","level":"info","event":"📋 [2025-06-09 20:37:27] ✅ Preparadas 9 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:27.654759Z","level":"info","event":"📋 2025-06-09 20:37:27,652 - INFO - ✅ Preparadas 9 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.017418Z","level":"info","event":"📋 [2025-06-09 20:37:28] ✅ Inseridos/atualizados 9 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.017998Z","level":"info","event":"📋 2025-06-09 20:37:28,017 - INFO - ✅ Inseridos/atualizados 9 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.023403Z","level":"info","event":"📋 [2025-06-09 20:37:28] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.023684Z","level":"info","event":"📋 2025-06-09 20:37:28,023 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.024226Z","level":"info","event":"📋 [2025-06-09 20:37:28] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.029822Z","level":"info","event":"📋 2025-06-09 20:37:28,024 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.029944Z","level":"info","event":"📋 [2025-06-09 20:37:28] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.030009Z","level":"info","event":"📋 2025-06-09 20:37:28,024 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.030067Z","level":"info","event":"📋 [2025-06-09 20:37:28] ✅ Exportação concluída com sucesso. Inseridos/atualizados 9 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.030122Z","level":"info","event":"📋 2025-06-09 20:37:28,024 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 9 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.030175Z","level":"info","event":"📋 [2025-06-09 20:37:28] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.030227Z","level":"info","event":"📋 2025-06-09 20:37:28,024 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.030277Z","level":"info","event":"📋 [2025-06-09 20:37:28] ✅ Exportação concluída com sucesso. Processados 9 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.030328Z","level":"info","event":"📋 2025-06-09 20:37:28,024 - INFO - ✅ Exportação concluída com sucesso. Processados 9 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.101114Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.101265Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.101414Z","level":"info","event":"⚠️ export_log: /opt/airflow/data/processed/2025/06/09/export_log_20250609.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.101503Z","level":"info","event":"✅ export_stats: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json (883 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.101621Z","level":"info","event":"✅ backup_csv: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv (2434 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T19:37:28.102065","level":"info","event":"Done. Returned value was: [2025-06-09 20:37:27] A iniciar export_to_supabase_airflow\n2025-06-09 20:37:27,156 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-09 20:37:27] Parâmetros: date=2025-06-09\n2025-06-09 20:37:27,156 - INFO - Parâmetros: date=2025-06-09\n[2025-06-09 20:37:27] Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09\n2025-06-09 20:37:27,156 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09\n[2025-06-09 20:37:27] 🚀 A iniciar exportação para Supabase para a data: 2025-06-09\n2025-06-09 20:37:27,156 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-09\n[2025-06-09 20:37:27] 📋 Tabela de destino: artigos_filtrados_20250609_staging\n2025-06-09 20:37:27,156 - INFO - 📋 Tabela de destino: artigos_filtrados_20250609_staging\n[2025-06-09 20:37:27] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09\n2025-06-09 20:37:27,156 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09\n[2025-06-09 20:37:27] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n2025-06-09 20:37:27,156 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n[2025-06-09 20:37:27] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n2025-06-09 20:37:27,156 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n[2025-06-09 20:37:27] 📊 Carregados 9 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-09 20:37:27,158 - INFO - 📊 Carregados 9 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-09 20:37:27] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-09 20:37:27,158 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-09 20:37:27] 🔍 Verificação inicial do ambiente...\n2025-06-09 20:37:27,159 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-09 20:37:27]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-09 20:37:27,159 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-09 20:37:27]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-09 20:37:27,159 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-09 20:37:27]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-09 20:37:27,159 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-09 20:37:27] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-09 20:37:27,159 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-09 20:37:27] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-09 20:37:27,159 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-09 20:37:27]   A verificar: /opt/airflow/.env\n2025-06-09 20:37:27,159 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-09 20:37:27]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-09 20:37:27,159 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-09 20:37:27]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-09 20:37:27,160 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-09 20:37:27] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-09 20:37:27,160 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-09 20:37:27] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-09 20:37:27,160 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-09 20:37:27]   ✅ Definido DB_USER do .env\n2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-09 20:37:27]   ✅ Definido DB_PASSWORD do .env\n2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-09 20:37:27]   ✅ Definido DB_HOST do .env\n2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-09 20:37:27]   ✅ Definido DB_PORT do .env\n2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-09 20:37:27]   ✅ Definido DB_NAME do .env\n2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-09 20:37:27]   ✅ Definido DB_SCHEMA do .env\n2025-06-09 20:37:27,160 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-09 20:37:27] 🔍 Verificação final da configuração...\n2025-06-09 20:37:27,160 - INFO - 🔍 Verificação final da configuração...\n[2025-06-09 20:37:27]   DB_HOST: DEFINIDO\n2025-06-09 20:37:27,160 - INFO -   DB_HOST: DEFINIDO\n[2025-06-09 20:37:27]   DB_USER: DEFINIDO\n2025-06-09 20:37:27,160 - INFO -   DB_USER: DEFINIDO\n[2025-06-09 20:37:27]   DB_PASSWORD: DEFINIDO\n2025-06-09 20:37:27,160 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-09 20:37:27]   DB_PORT: 6543\n2025-06-09 20:37:27,160 - INFO -   DB_PORT: 6543\n[2025-06-09 20:37:27]   DB_NAME: postgres\n2025-06-09 20:37:27,160 - INFO -   DB_NAME: postgres\n[2025-06-09 20:37:27]   DB_SCHEMA: google_scraper\n2025-06-09 20:37:27,160 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-09 20:37:27] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-09 20:37:27,161 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-09 20:37:27] 🔗 A conectar à base de dados...\n2025-06-09 20:37:27,161 - INFO - 🔗 A conectar à base de dados...\n[2025-06-09 20:37:27] ✅ Conectado à base de dados com sucesso\n2025-06-09 20:37:27,422 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-09 20:37:27] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia\n2025-06-09 20:37:27,482 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia\n[2025-06-09 20:37:27] ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto\n2025-06-09 20:37:27,565 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto\n[2025-06-09 20:37:27] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging\n2025-06-09 20:37:27,647 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging\n[2025-06-09 20:37:27] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-09 20:37:27,647 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-09 20:37:27] 📅 A converter formatos de data...\n2025-06-09 20:37:27,647 - INFO - 📅 A converter formatos de data...\n[2025-06-09 20:37:27] ✅ Preparadas 9 linhas para inserção\n2025-06-09 20:37:27,652 - INFO - ✅ Preparadas 9 linhas para inserção\n[2025-06-09 20:37:28] ✅ Inseridos/atualizados 9 artigos (falharam: 0)\n2025-06-09 20:37:28,017 - INFO - ✅ Inseridos/atualizados 9 artigos (falharam: 0)\n[2025-06-09 20:37:28] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n2025-06-09 20:37:28,023 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n[2025-06-09 20:37:28] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json\n2025-06-09 20:37:28,024 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json\n[2025-06-09 20:37:28] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n2025-06-09 20:37:28,024 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n[2025-06-09 20:37:28] ✅ Exportação concluída com sucesso. Inseridos/atualizados 9 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging\n2025-06-09 20:37:28,024 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 9 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging\n[2025-06-09 20:37:28] 🔗 Ligação à base de dados fechada\n2025-06-09 20:37:28,024 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-09 20:37:28] ✅ Exportação concluída com sucesso. Processados 9 artigos\n2025-06-09 20:37:28,024 - INFO - ✅ Exportação concluída com sucesso. Processados 9 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
