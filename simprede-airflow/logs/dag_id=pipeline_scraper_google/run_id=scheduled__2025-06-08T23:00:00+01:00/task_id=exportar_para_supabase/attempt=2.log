{"timestamp":"2025-06-09T08:41:10.530481","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-09T08:41:10.530783","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-09T08:41:10.568270Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.568513Z","level":"info","event":"📅 Using current date: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.568781Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/data/raw/2025/06/09', '/opt/airflow/data/structured/2025/06/09', '/opt/airflow/data/processed/2025/06/09']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.568834Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.568876Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.568916Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.568958Z","level":"info","event":"  - Target date: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.568996Z","level":"info","event":"  - Database table: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.569032Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.575441Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.575571Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/09/artigos_vitimas_filtrados_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.575995Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/09/artigos_sem_vitimas_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576066Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576252Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (938 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576386Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576458Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (938 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576530Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/09/processing_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576609Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/09/processing_stats_20250609.json (393 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576665Z","level":"info","event":"📋 Selected input file: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv (938 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576716Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576765Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576806Z","level":"info","event":"  - export_log: /opt/airflow/data/processed/2025/06/09/export_log_20250609.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576886Z","level":"info","event":"  - export_stats: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576936Z","level":"info","event":"  - backup_csv: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.576977Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/data/processed/2025/06/09 --date_str 2025-06-09 --input_file /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv --date 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:10.577052Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.398252Z","level":"info","event":"📋 [2025-06-09 09:41:11] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.398517Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.398653Z","level":"info","event":"📋 [2025-06-09 09:41:11] Parâmetros: date=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399068Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - Parâmetros: date=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399142Z","level":"info","event":"📋 [2025-06-09 09:41:11] Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399194Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399243Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🚀 A iniciar exportação para Supabase para a data: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399291Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399341Z","level":"info","event":"📋 [2025-06-09 09:41:11] 📋 Tabela de destino: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399388Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - 📋 Tabela de destino: artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399433Z","level":"info","event":"📋 [2025-06-09 09:41:11] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.399506Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400394Z","level":"info","event":"📋 [2025-06-09 09:41:11] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400460Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400514Z","level":"info","event":"📋 [2025-06-09 09:41:11] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400613Z","level":"info","event":"📋 2025-06-09 09:41:11,398 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400688Z","level":"info","event":"📋 [2025-06-09 09:41:11] 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400759Z","level":"info","event":"📋 2025-06-09 09:41:11,400 - INFO - 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400867Z","level":"info","event":"📋 [2025-06-09 09:41:11] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.400931Z","level":"info","event":"📋 2025-06-09 09:41:11,400 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401028Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401074Z","level":"info","event":"📋 2025-06-09 09:41:11,400 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401131Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401184Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401285Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401475Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401595Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.401673Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402080Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402142Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402193Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402241Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402287Z","level":"info","event":"📋 [2025-06-09 09:41:11]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402710Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402820Z","level":"info","event":"📋 [2025-06-09 09:41:11]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.402894Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403011Z","level":"info","event":"📋 [2025-06-09 09:41:11]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403084Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403154Z","level":"info","event":"📋 [2025-06-09 09:41:11] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403230Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403382Z","level":"info","event":"📋 [2025-06-09 09:41:11] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403436Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403495Z","level":"info","event":"📋 [2025-06-09 09:41:11]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403559Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403615Z","level":"info","event":"📋 [2025-06-09 09:41:11]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403673Z","level":"info","event":"📋 2025-06-09 09:41:11,401 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403729Z","level":"info","event":"📋 [2025-06-09 09:41:11]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403792Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403855Z","level":"info","event":"📋 [2025-06-09 09:41:11]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.403935Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404017Z","level":"info","event":"📋 [2025-06-09 09:41:11]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404077Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404135Z","level":"info","event":"📋 [2025-06-09 09:41:11]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404201Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404269Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404332Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404385Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404484Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404538Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404596Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404651Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404716Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404769Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404816Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404862Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404907Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.404970Z","level":"info","event":"📋 [2025-06-09 09:41:11]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.405034Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.405086Z","level":"info","event":"📋 [2025-06-09 09:41:11] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.405134Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.405196Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.405250Z","level":"info","event":"📋 2025-06-09 09:41:11,402 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.677718Z","level":"info","event":"📋 [2025-06-09 09:41:11] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.678298Z","level":"info","event":"📋 2025-06-09 09:41:11,677 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.746731Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.747594Z","level":"info","event":"📋 2025-06-09 09:41:11,746 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.835739Z","level":"info","event":"📋 [2025-06-09 09:41:11] ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.836584Z","level":"info","event":"📋 2025-06-09 09:41:11,835 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.924265Z","level":"info","event":"📋 [2025-06-09 09:41:11] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.931040Z","level":"info","event":"📋 2025-06-09 09:41:11,923 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.931621Z","level":"info","event":"📋 [2025-06-09 09:41:11] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.931781Z","level":"info","event":"📋 2025-06-09 09:41:11,924 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.931908Z","level":"info","event":"📋 [2025-06-09 09:41:11] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.932062Z","level":"info","event":"📋 2025-06-09 09:41:11,924 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.933159Z","level":"info","event":"📋 [2025-06-09 09:41:11] ✅ Preparadas 3 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:11.933874Z","level":"info","event":"📋 2025-06-09 09:41:11,933 - INFO - ✅ Preparadas 3 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.056520Z","level":"info","event":"📋 [2025-06-09 09:41:12] ✅ Inseridos/atualizados 3 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.057540Z","level":"info","event":"📋 2025-06-09 09:41:12,056 - INFO - ✅ Inseridos/atualizados 3 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.063181Z","level":"info","event":"📋 [2025-06-09 09:41:12] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.063418Z","level":"info","event":"📋 2025-06-09 09:41:12,063 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.064308Z","level":"info","event":"📋 [2025-06-09 09:41:12] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.068015Z","level":"info","event":"📋 2025-06-09 09:41:12,064 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.072002Z","level":"info","event":"📋 [2025-06-09 09:41:12] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.072262Z","level":"info","event":"📋 2025-06-09 09:41:12,064 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.072482Z","level":"info","event":"📋 [2025-06-09 09:41:12] ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.072734Z","level":"info","event":"📋 2025-06-09 09:41:12,064 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.072941Z","level":"info","event":"📋 [2025-06-09 09:41:12] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.073191Z","level":"info","event":"📋 2025-06-09 09:41:12,064 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.073436Z","level":"info","event":"📋 [2025-06-09 09:41:12] ✅ Exportação concluída com sucesso. Processados 3 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.073696Z","level":"info","event":"📋 2025-06-09 09:41:12,064 - INFO - ✅ Exportação concluída com sucesso. Processados 3 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.139637Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.139806Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.140015Z","level":"info","event":"⚠️ export_log: /opt/airflow/data/processed/2025/06/09/export_log_20250609.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.140168Z","level":"info","event":"✅ export_stats: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json (883 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.140281Z","level":"info","event":"✅ backup_csv: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv (937 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T08:41:12.140649","level":"info","event":"Done. Returned value was: [2025-06-09 09:41:11] A iniciar export_to_supabase_airflow\n2025-06-09 09:41:11,398 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-09 09:41:11] Parâmetros: date=2025-06-09\n2025-06-09 09:41:11,398 - INFO - Parâmetros: date=2025-06-09\n[2025-06-09 09:41:11] Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09\n2025-06-09 09:41:11,398 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv, output_dir=/opt/airflow/data/processed/2025/06/09, date_str=2025-06-09\n[2025-06-09 09:41:11] 🚀 A iniciar exportação para Supabase para a data: 2025-06-09\n2025-06-09 09:41:11,398 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-09\n[2025-06-09 09:41:11] 📋 Tabela de destino: artigos_filtrados_20250609_staging\n2025-06-09 09:41:11,398 - INFO - 📋 Tabela de destino: artigos_filtrados_20250609_staging\n[2025-06-09 09:41:11] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09\n2025-06-09 09:41:11,398 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/09\n[2025-06-09 09:41:11] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n2025-06-09 09:41:11,398 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n[2025-06-09 09:41:11] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n2025-06-09 09:41:11,398 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/09/artigos_google_municipios_pt_2025-06-09.csv\n[2025-06-09 09:41:11] 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-09 09:41:11,400 - INFO - 📊 Carregados 3 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-09 09:41:11] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-09 09:41:11,400 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-09 09:41:11] 🔍 Verificação inicial do ambiente...\n2025-06-09 09:41:11,400 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-09 09:41:11]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-09 09:41:11,401 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-09 09:41:11]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-09 09:41:11,401 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-09 09:41:11]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-09 09:41:11,401 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-09 09:41:11] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-09 09:41:11,401 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-09 09:41:11] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-09 09:41:11,401 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-09 09:41:11]   A verificar: /opt/airflow/.env\n2025-06-09 09:41:11,401 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-09 09:41:11]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-09 09:41:11,401 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-09 09:41:11]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-09 09:41:11,401 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-09 09:41:11] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-09 09:41:11,401 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-09 09:41:11] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-09 09:41:11,401 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-09 09:41:11]   ✅ Definido DB_USER do .env\n2025-06-09 09:41:11,401 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-09 09:41:11]   ✅ Definido DB_PASSWORD do .env\n2025-06-09 09:41:11,401 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-09 09:41:11]   ✅ Definido DB_HOST do .env\n2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-09 09:41:11]   ✅ Definido DB_PORT do .env\n2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-09 09:41:11]   ✅ Definido DB_NAME do .env\n2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-09 09:41:11]   ✅ Definido DB_SCHEMA do .env\n2025-06-09 09:41:11,402 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-09 09:41:11] 🔍 Verificação final da configuração...\n2025-06-09 09:41:11,402 - INFO - 🔍 Verificação final da configuração...\n[2025-06-09 09:41:11]   DB_HOST: DEFINIDO\n2025-06-09 09:41:11,402 - INFO -   DB_HOST: DEFINIDO\n[2025-06-09 09:41:11]   DB_USER: DEFINIDO\n2025-06-09 09:41:11,402 - INFO -   DB_USER: DEFINIDO\n[2025-06-09 09:41:11]   DB_PASSWORD: DEFINIDO\n2025-06-09 09:41:11,402 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-09 09:41:11]   DB_PORT: 6543\n2025-06-09 09:41:11,402 - INFO -   DB_PORT: 6543\n[2025-06-09 09:41:11]   DB_NAME: postgres\n2025-06-09 09:41:11,402 - INFO -   DB_NAME: postgres\n[2025-06-09 09:41:11]   DB_SCHEMA: google_scraper\n2025-06-09 09:41:11,402 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-09 09:41:11] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-09 09:41:11,402 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-09 09:41:11] 🔗 A conectar à base de dados...\n2025-06-09 09:41:11,402 - INFO - 🔗 A conectar à base de dados...\n[2025-06-09 09:41:11] ✅ Conectado à base de dados com sucesso\n2025-06-09 09:41:11,677 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-09 09:41:11] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia\n2025-06-09 09:41:11,746 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250609_staging eliminada se existia\n[2025-06-09 09:41:11] ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto\n2025-06-09 09:41:11,835 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250609_staging criada com esquema correto\n[2025-06-09 09:41:11] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging\n2025-06-09 09:41:11,923 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250609_staging\n[2025-06-09 09:41:11] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-09 09:41:11,924 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-09 09:41:11] 📅 A converter formatos de data...\n2025-06-09 09:41:11,924 - INFO - 📅 A converter formatos de data...\n[2025-06-09 09:41:11] ✅ Preparadas 3 linhas para inserção\n2025-06-09 09:41:11,933 - INFO - ✅ Preparadas 3 linhas para inserção\n[2025-06-09 09:41:12] ✅ Inseridos/atualizados 3 artigos (falharam: 0)\n2025-06-09 09:41:12,056 - INFO - ✅ Inseridos/atualizados 3 artigos (falharam: 0)\n[2025-06-09 09:41:12] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n2025-06-09 09:41:12,063 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n[2025-06-09 09:41:12] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json\n2025-06-09 09:41:12,064 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/09/export_stats_20250609.json\n[2025-06-09 09:41:12] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n2025-06-09 09:41:12,064 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/09/export_backup_20250609.csv\n[2025-06-09 09:41:12] ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging\n2025-06-09 09:41:12,064 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 3 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250609_staging\n[2025-06-09 09:41:12] 🔗 Ligação à base de dados fechada\n2025-06-09 09:41:12,064 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-09 09:41:12] ✅ Exportação concluída com sucesso. Processados 3 artigos\n2025-06-09 09:41:12,064 - INFO - ✅ Exportação concluída com sucesso. Processados 3 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
