{"timestamp":"2025-06-05T17:38:19.537948","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-05T17:38:19.538262","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-05T17:38:19.577764Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578026Z","level":"info","event":"📅 Using current date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578270Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/05', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/05', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/05']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578371Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578448Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578522Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578584Z","level":"info","event":"  - Target date: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578649Z","level":"info","event":"  - Database table: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.578707Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.585543Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.585643Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/artigos_vitimas_filtrados_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.586114Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/artigos_sem_vitimas_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.586212Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.586498Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (1915 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.586661Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.586770Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (1915 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.586844Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/processing_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.586923Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/processing_stats_20250605.json (416 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587019Z","level":"info","event":"📋 Selected input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv (1915 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587086Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587215Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587274Z","level":"info","event":"  - export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_log_20250605.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587327Z","level":"info","event":"  - export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587379Z","level":"info","event":"  - backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587432Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/scripts/google_scraper/data/processed/2025/06/05 --date_str 2025-06-05 --input_file /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv --date 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:19.587500Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.498791Z","level":"info","event":"📋 [2025-06-05 18:38:20] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.499636Z","level":"info","event":"📋 2025-06-05 18:38:20,498 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.500004Z","level":"info","event":"📋 [2025-06-05 18:38:20] Parâmetros: date=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.500760Z","level":"info","event":"📋 2025-06-05 18:38:20,498 - INFO - Parâmetros: date=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.501060Z","level":"info","event":"📋 [2025-06-05 18:38:20] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.501493Z","level":"info","event":"📋 2025-06-05 18:38:20,498 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.501727Z","level":"info","event":"📋 [2025-06-05 18:38:20] 🚀 A iniciar exportação para Supabase para a data: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.501846Z","level":"info","event":"📋 2025-06-05 18:38:20,498 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.502720Z","level":"info","event":"📋 [2025-06-05 18:38:20] 📋 Tabela de destino: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.503467Z","level":"info","event":"📋 2025-06-05 18:38:20,498 - INFO - 📋 Tabela de destino: artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.503848Z","level":"info","event":"📋 [2025-06-05 18:38:20] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.504530Z","level":"info","event":"📋 2025-06-05 18:38:20,499 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.504885Z","level":"info","event":"📋 [2025-06-05 18:38:20] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.505145Z","level":"info","event":"📋 2025-06-05 18:38:20,500 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.505482Z","level":"info","event":"📋 [2025-06-05 18:38:20] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.509183Z","level":"info","event":"📋 2025-06-05 18:38:20,500 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.509431Z","level":"info","event":"📋 [2025-06-05 18:38:20] 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.509573Z","level":"info","event":"📋 2025-06-05 18:38:20,505 - INFO - 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.509997Z","level":"info","event":"📋 [2025-06-05 18:38:20] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.510058Z","level":"info","event":"📋 2025-06-05 18:38:20,505 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.510118Z","level":"info","event":"📋 [2025-06-05 18:38:20] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.510175Z","level":"info","event":"📋 2025-06-05 18:38:20,505 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.510226Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.510277Z","level":"info","event":"📋 2025-06-05 18:38:20,505 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.510327Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.510896Z","level":"info","event":"📋 2025-06-05 18:38:20,505 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511072Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511153Z","level":"info","event":"📋 2025-06-05 18:38:20,505 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511306Z","level":"info","event":"📋 [2025-06-05 18:38:20] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511423Z","level":"info","event":"📋 2025-06-05 18:38:20,505 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511593Z","level":"info","event":"📋 [2025-06-05 18:38:20] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511670Z","level":"info","event":"📋 2025-06-05 18:38:20,506 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511774Z","level":"info","event":"📋 [2025-06-05 18:38:20]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511843Z","level":"info","event":"📋 2025-06-05 18:38:20,506 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511902Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.511966Z","level":"info","event":"📋 2025-06-05 18:38:20,506 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.512050Z","level":"info","event":"📋 [2025-06-05 18:38:20]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.512126Z","level":"info","event":"📋 2025-06-05 18:38:20,506 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.512220Z","level":"info","event":"📋 [2025-06-05 18:38:20] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.512451Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.512585Z","level":"info","event":"📋 [2025-06-05 18:38:20] 📄 Tamanho do ficheiro .env: 184 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.512654Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO - 📄 Tamanho do ficheiro .env: 184 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.512968Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513123Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513213Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513274Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513335Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513464Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513572Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513639Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513686Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.513829Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514013Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ✅ Definido DB_SSLMODE do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514101Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_SSLMODE do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514211Z","level":"info","event":"📋 [2025-06-05 18:38:20]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514269Z","level":"info","event":"📋 2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514332Z","level":"info","event":"📋 [2025-06-05 18:38:20] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514381Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514441Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514503Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514562Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514615Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514683Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514748Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514809Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514865Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514930Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.514972Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.515025Z","level":"info","event":"📋 [2025-06-05 18:38:20]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.515084Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.515135Z","level":"info","event":"📋 [2025-06-05 18:38:20] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.515185Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.515231Z","level":"info","event":"📋 [2025-06-05 18:38:20] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.515280Z","level":"info","event":"📋 2025-06-05 18:38:20,510 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.963775Z","level":"info","event":"📋 [2025-06-05 18:38:20] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:20.964671Z","level":"info","event":"📋 2025-06-05 18:38:20,963 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.039442Z","level":"info","event":"📋 [2025-06-05 18:38:21] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.041161Z","level":"info","event":"📋 2025-06-05 18:38:21,038 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.141208Z","level":"info","event":"📋 [2025-06-05 18:38:21] ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.141825Z","level":"info","event":"📋 2025-06-05 18:38:21,141 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.302382Z","level":"info","event":"📋 [2025-06-05 18:38:21] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.304742Z","level":"info","event":"📋 2025-06-05 18:38:21,302 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.304846Z","level":"info","event":"📋 [2025-06-05 18:38:21] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.304926Z","level":"info","event":"📋 2025-06-05 18:38:21,302 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.304991Z","level":"info","event":"📋 [2025-06-05 18:38:21] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.305053Z","level":"info","event":"📋 2025-06-05 18:38:21,302 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.305113Z","level":"info","event":"📋 [2025-06-05 18:38:21] ✅ Preparadas 7 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.305172Z","level":"info","event":"📋 2025-06-05 18:38:21,304 - INFO - ✅ Preparadas 7 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.762781Z","level":"info","event":"📋 [2025-06-05 18:38:21] ✅ Inseridos/atualizados 7 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.767894Z","level":"info","event":"📋 2025-06-05 18:38:21,762 - INFO - ✅ Inseridos/atualizados 7 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.777239Z","level":"info","event":"📋 [2025-06-05 18:38:21] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.778050Z","level":"info","event":"📋 2025-06-05 18:38:21,776 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.779950Z","level":"info","event":"📋 [2025-06-05 18:38:21] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.785016Z","level":"info","event":"📋 2025-06-05 18:38:21,779 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.785846Z","level":"info","event":"📋 [2025-06-05 18:38:21] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.786406Z","level":"info","event":"📋 2025-06-05 18:38:21,779 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.786914Z","level":"info","event":"📋 [2025-06-05 18:38:21] ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.787593Z","level":"info","event":"📋 2025-06-05 18:38:21,780 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.788833Z","level":"info","event":"📋 [2025-06-05 18:38:21] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.788960Z","level":"info","event":"📋 2025-06-05 18:38:21,780 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.789075Z","level":"info","event":"📋 [2025-06-05 18:38:21] ✅ Exportação concluída com sucesso. Processados 7 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.789189Z","level":"info","event":"📋 2025-06-05 18:38:21,780 - INFO - ✅ Exportação concluída com sucesso. Processados 7 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.885897Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.886094Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.886278Z","level":"info","event":"⚠️ export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_log_20250605.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.886395Z","level":"info","event":"✅ export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json (929 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.886491Z","level":"info","event":"✅ backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv (1909 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-05T17:38:21.886966","level":"info","event":"Done. Returned value was: [2025-06-05 18:38:20] A iniciar export_to_supabase_airflow\n2025-06-05 18:38:20,498 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-05 18:38:20] Parâmetros: date=2025-06-05\n2025-06-05 18:38:20,498 - INFO - Parâmetros: date=2025-06-05\n[2025-06-05 18:38:20] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05\n2025-06-05 18:38:20,498 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/05, date_str=2025-06-05\n[2025-06-05 18:38:20] 🚀 A iniciar exportação para Supabase para a data: 2025-06-05\n2025-06-05 18:38:20,498 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-05\n[2025-06-05 18:38:20] 📋 Tabela de destino: artigos_filtrados_20250605_staging\n2025-06-05 18:38:20,498 - INFO - 📋 Tabela de destino: artigos_filtrados_20250605_staging\n[2025-06-05 18:38:20] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05\n2025-06-05 18:38:20,499 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05\n[2025-06-05 18:38:20] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n2025-06-05 18:38:20,500 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n[2025-06-05 18:38:20] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n2025-06-05 18:38:20,500 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/05/artigos_google_municipios_pt_2025-06-05.csv\n[2025-06-05 18:38:20] 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-05 18:38:20,505 - INFO - 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-05 18:38:20] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-05 18:38:20,505 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-05 18:38:20] 🔍 Verificação inicial do ambiente...\n2025-06-05 18:38:20,505 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-05 18:38:20]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-05 18:38:20,505 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-05 18:38:20]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-05 18:38:20,505 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-05 18:38:20]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-05 18:38:20,505 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-05 18:38:20] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-05 18:38:20,505 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-05 18:38:20] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-05 18:38:20,506 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-05 18:38:20]   A verificar: /opt/airflow/.env\n2025-06-05 18:38:20,506 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-05 18:38:20]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-05 18:38:20,506 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-05 18:38:20]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-05 18:38:20,506 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-05 18:38:20] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-05 18:38:20,509 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-05 18:38:20] 📄 Tamanho do ficheiro .env: 184 caracteres\n2025-06-05 18:38:20,509 - INFO - 📄 Tamanho do ficheiro .env: 184 caracteres\n[2025-06-05 18:38:20]   ✅ Definido DB_HOST do .env\n2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-05 18:38:20]   ✅ Definido DB_PORT do .env\n2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-05 18:38:20]   ✅ Definido DB_NAME do .env\n2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-05 18:38:20]   ✅ Definido DB_USER do .env\n2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-05 18:38:20]   ✅ Definido DB_PASSWORD do .env\n2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-05 18:38:20]   ✅ Definido DB_SSLMODE do .env\n2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_SSLMODE do .env\n[2025-06-05 18:38:20]   ✅ Definido DB_SCHEMA do .env\n2025-06-05 18:38:20,509 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-05 18:38:20] 🔍 Verificação final da configuração...\n2025-06-05 18:38:20,510 - INFO - 🔍 Verificação final da configuração...\n[2025-06-05 18:38:20]   DB_HOST: DEFINIDO\n2025-06-05 18:38:20,510 - INFO -   DB_HOST: DEFINIDO\n[2025-06-05 18:38:20]   DB_USER: DEFINIDO\n2025-06-05 18:38:20,510 - INFO -   DB_USER: DEFINIDO\n[2025-06-05 18:38:20]   DB_PASSWORD: DEFINIDO\n2025-06-05 18:38:20,510 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-05 18:38:20]   DB_PORT: 6543\n2025-06-05 18:38:20,510 - INFO -   DB_PORT: 6543\n[2025-06-05 18:38:20]   DB_NAME: postgres\n2025-06-05 18:38:20,510 - INFO -   DB_NAME: postgres\n[2025-06-05 18:38:20]   DB_SCHEMA: google_scraper\n2025-06-05 18:38:20,510 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-05 18:38:20] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-05 18:38:20,510 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-05 18:38:20] 🔗 A conectar à base de dados...\n2025-06-05 18:38:20,510 - INFO - 🔗 A conectar à base de dados...\n[2025-06-05 18:38:20] ✅ Conectado à base de dados com sucesso\n2025-06-05 18:38:20,963 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-05 18:38:21] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia\n2025-06-05 18:38:21,038 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250605_staging eliminada se existia\n[2025-06-05 18:38:21] ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto\n2025-06-05 18:38:21,141 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250605_staging criada com esquema correto\n[2025-06-05 18:38:21] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging\n2025-06-05 18:38:21,302 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250605_staging\n[2025-06-05 18:38:21] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-05 18:38:21,302 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-05 18:38:21] 📅 A converter formatos de data...\n2025-06-05 18:38:21,302 - INFO - 📅 A converter formatos de data...\n[2025-06-05 18:38:21] ✅ Preparadas 7 linhas para inserção\n2025-06-05 18:38:21,304 - INFO - ✅ Preparadas 7 linhas para inserção\n[2025-06-05 18:38:21] ✅ Inseridos/atualizados 7 artigos (falharam: 0)\n2025-06-05 18:38:21,762 - INFO - ✅ Inseridos/atualizados 7 artigos (falharam: 0)\n[2025-06-05 18:38:21] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n2025-06-05 18:38:21,776 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n[2025-06-05 18:38:21] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json\n2025-06-05 18:38:21,779 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_stats_20250605.json\n[2025-06-05 18:38:21] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n2025-06-05 18:38:21,779 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/05/export_backup_20250605.csv\n[2025-06-05 18:38:21] ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging\n2025-06-05 18:38:21,780 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250605_staging\n[2025-06-05 18:38:21] 🔗 Ligação à base de dados fechada\n2025-06-05 18:38:21,780 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-05 18:38:21] ✅ Exportação concluída com sucesso. Processados 7 artigos\n2025-06-05 18:38:21,780 - INFO - ✅ Exportação concluída com sucesso. Processados 7 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
