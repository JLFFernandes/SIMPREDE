{"timestamp":"2025-06-09T23:09:43.015699","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-09T23:09:43.016187","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-09T23:09:43.055653Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.055970Z","level":"info","event":"📅 Using current date: 2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.056320Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/data/raw/2025/06/10', '/opt/airflow/data/structured/2025/06/10', '/opt/airflow/data/processed/2025/06/10']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.056391Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.056447Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.056498Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.056548Z","level":"info","event":"  - Target date: 2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.056596Z","level":"info","event":"  - Database table: artigos_filtrados_20250610_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.056645Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.064512Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.064614Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/10/artigos_vitimas_filtrados_20250610.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.065165Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/processed/2025/06/10/artigos_sem_vitimas_20250610.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.065260Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.065530Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv (6868 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.065683Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.065784Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv (6868 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.065869Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/data/structured/2025/06/10/processing_stats_20250610.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.065950Z","level":"info","event":"✅ Found file: /opt/airflow/data/structured/2025/06/10/processing_stats_20250610.json (395 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066056Z","level":"info","event":"📋 Selected input file: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv (6868 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066165Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066256Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066332Z","level":"info","event":"  - export_log: /opt/airflow/data/processed/2025/06/10/export_log_20250610.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066459Z","level":"info","event":"  - export_stats: /opt/airflow/data/processed/2025/06/10/export_stats_20250610.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066524Z","level":"info","event":"  - backup_csv: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066581Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/data/processed/2025/06/10 --date_str 2025-06-10 --input_file /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv --date 2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:43.066661Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.447856Z","level":"info","event":"📋 [2025-06-10 00:09:44] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.448317Z","level":"info","event":"📋 2025-06-10 00:09:44,447 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.448527Z","level":"info","event":"📋 [2025-06-10 00:09:44] Parâmetros: date=2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.448742Z","level":"info","event":"📋 2025-06-10 00:09:44,447 - INFO - Parâmetros: date=2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.449375Z","level":"info","event":"📋 [2025-06-10 00:09:44] Caminhos: input_file=/opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv, output_dir=/opt/airflow/data/processed/2025/06/10, date_str=2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.449671Z","level":"info","event":"📋 2025-06-10 00:09:44,447 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv, output_dir=/opt/airflow/data/processed/2025/06/10, date_str=2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.449800Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🚀 A iniciar exportação para Supabase para a data: 2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.449886Z","level":"info","event":"📋 2025-06-10 00:09:44,447 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.449969Z","level":"info","event":"📋 [2025-06-10 00:09:44] 📋 Tabela de destino: artigos_filtrados_20250610_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.450583Z","level":"info","event":"📋 2025-06-10 00:09:44,447 - INFO - 📋 Tabela de destino: artigos_filtrados_20250610_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.451286Z","level":"info","event":"📋 [2025-06-10 00:09:44] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.451678Z","level":"info","event":"📋 2025-06-10 00:09:44,447 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/10","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.451814Z","level":"info","event":"📋 [2025-06-10 00:09:44] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.451907Z","level":"info","event":"📋 2025-06-10 00:09:44,448 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.451998Z","level":"info","event":"📋 [2025-06-10 00:09:44] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.452767Z","level":"info","event":"📋 2025-06-10 00:09:44,448 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.452940Z","level":"info","event":"📋 [2025-06-10 00:09:44] 📊 Carregados 26 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.453815Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO - 📊 Carregados 26 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.454185Z","level":"info","event":"📋 [2025-06-10 00:09:44] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.454276Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.454357Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.454440Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.454522Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.455179Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.455403Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.455588Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.455781Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.455961Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.456191Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.456353Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.456474Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.456604Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.456753Z","level":"info","event":"📋 [2025-06-10 00:09:44]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.456869Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457018Z","level":"info","event":"📋 [2025-06-10 00:09:44]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457133Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457251Z","level":"info","event":"📋 [2025-06-10 00:09:44]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457359Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457465Z","level":"info","event":"📋 [2025-06-10 00:09:44] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457550Z","level":"info","event":"📋 2025-06-10 00:09:44,452 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457671Z","level":"info","event":"📋 [2025-06-10 00:09:44] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457762Z","level":"info","event":"📋 2025-06-10 00:09:44,453 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457856Z","level":"info","event":"📋 [2025-06-10 00:09:44]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.457933Z","level":"info","event":"📋 2025-06-10 00:09:44,453 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458010Z","level":"info","event":"📋 [2025-06-10 00:09:44]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458081Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458173Z","level":"info","event":"📋 [2025-06-10 00:09:44]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458275Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458378Z","level":"info","event":"📋 [2025-06-10 00:09:44]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458482Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458579Z","level":"info","event":"📋 [2025-06-10 00:09:44]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458675Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458771Z","level":"info","event":"📋 [2025-06-10 00:09:44]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458868Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.458963Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459073Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459195Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459351Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459446Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459542Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459637Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459734Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459829Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.459924Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460018Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460132Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460227Z","level":"info","event":"📋 [2025-06-10 00:09:44]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460321Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460415Z","level":"info","event":"📋 [2025-06-10 00:09:44] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460507Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460601Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.460694Z","level":"info","event":"📋 2025-06-10 00:09:44,454 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.729869Z","level":"info","event":"📋 [2025-06-10 00:09:44] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.730471Z","level":"info","event":"📋 2025-06-10 00:09:44,729 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.767791Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250610_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.768238Z","level":"info","event":"📋 2025-06-10 00:09:44,767 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250610_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.837067Z","level":"info","event":"📋 [2025-06-10 00:09:44] ✅ Tabela google_scraper.artigos_filtrados_20250610_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.837262Z","level":"info","event":"📋 2025-06-10 00:09:44,835 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250610_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.922084Z","level":"info","event":"📋 [2025-06-10 00:09:44] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250610_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.925166Z","level":"info","event":"📋 2025-06-10 00:09:44,921 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250610_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.926159Z","level":"info","event":"📋 [2025-06-10 00:09:44] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.926316Z","level":"info","event":"📋 2025-06-10 00:09:44,922 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.926436Z","level":"info","event":"📋 [2025-06-10 00:09:44] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.926541Z","level":"info","event":"📋 2025-06-10 00:09:44,922 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.926666Z","level":"info","event":"📋 [2025-06-10 00:09:44] ✅ Preparadas 26 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:44.926761Z","level":"info","event":"📋 2025-06-10 00:09:44,925 - INFO - ✅ Preparadas 26 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.938924Z","level":"info","event":"📋 [2025-06-10 00:09:45] ✅ Inseridos/atualizados 26 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.940227Z","level":"info","event":"📋 2025-06-10 00:09:45,938 - INFO - ✅ Inseridos/atualizados 26 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.946699Z","level":"info","event":"📋 [2025-06-10 00:09:45] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.947071Z","level":"info","event":"📋 2025-06-10 00:09:45,946 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.948399Z","level":"info","event":"📋 [2025-06-10 00:09:45] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/10/export_stats_20250610.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.951238Z","level":"info","event":"📋 2025-06-10 00:09:45,948 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/10/export_stats_20250610.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.952141Z","level":"info","event":"📋 [2025-06-10 00:09:45] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.954128Z","level":"info","event":"📋 2025-06-10 00:09:45,948 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.954388Z","level":"info","event":"📋 [2025-06-10 00:09:45] ✅ Exportação concluída com sucesso. Inseridos/atualizados 26 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250610_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.954547Z","level":"info","event":"📋 2025-06-10 00:09:45,948 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 26 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250610_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.954694Z","level":"info","event":"📋 [2025-06-10 00:09:45] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.954833Z","level":"info","event":"📋 2025-06-10 00:09:45,948 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.954966Z","level":"info","event":"📋 [2025-06-10 00:09:45] ✅ Exportação concluída com sucesso. Processados 26 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:45.955206Z","level":"info","event":"📋 2025-06-10 00:09:45,949 - INFO - ✅ Exportação concluída com sucesso. Processados 26 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:46.048499Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:46.048705Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:46.048908Z","level":"info","event":"⚠️ export_log: /opt/airflow/data/processed/2025/06/10/export_log_20250610.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:46.049018Z","level":"info","event":"✅ export_stats: /opt/airflow/data/processed/2025/06/10/export_stats_20250610.json (885 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:46.049121Z","level":"info","event":"✅ backup_csv: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv (6846 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-09T23:09:46.049349","level":"info","event":"Done. Returned value was: [2025-06-10 00:09:44] A iniciar export_to_supabase_airflow\n2025-06-10 00:09:44,447 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-10 00:09:44] Parâmetros: date=2025-06-10\n2025-06-10 00:09:44,447 - INFO - Parâmetros: date=2025-06-10\n[2025-06-10 00:09:44] Caminhos: input_file=/opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv, output_dir=/opt/airflow/data/processed/2025/06/10, date_str=2025-06-10\n2025-06-10 00:09:44,447 - INFO - Caminhos: input_file=/opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv, output_dir=/opt/airflow/data/processed/2025/06/10, date_str=2025-06-10\n[2025-06-10 00:09:44] 🚀 A iniciar exportação para Supabase para a data: 2025-06-10\n2025-06-10 00:09:44,447 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-10\n[2025-06-10 00:09:44] 📋 Tabela de destino: artigos_filtrados_20250610_staging\n2025-06-10 00:09:44,447 - INFO - 📋 Tabela de destino: artigos_filtrados_20250610_staging\n[2025-06-10 00:09:44] 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/10\n2025-06-10 00:09:44,447 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/data/processed/2025/06/10\n[2025-06-10 00:09:44] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv\n2025-06-10 00:09:44,448 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv\n[2025-06-10 00:09:44] 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv\n2025-06-10 00:09:44,448 - INFO - 📂 A carregar artigos de: /opt/airflow/data/structured/2025/06/10/artigos_google_municipios_pt_2025-06-10.csv\n[2025-06-10 00:09:44] 📊 Carregados 26 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-10 00:09:44,452 - INFO - 📊 Carregados 26 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-10 00:09:44] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-10 00:09:44,452 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-10 00:09:44] 🔍 Verificação inicial do ambiente...\n2025-06-10 00:09:44,452 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-10 00:09:44]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-10 00:09:44,452 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-10 00:09:44]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-10 00:09:44,452 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-10 00:09:44]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-10 00:09:44,452 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-10 00:09:44] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-10 00:09:44,452 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-10 00:09:44] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-10 00:09:44,452 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-10 00:09:44]   A verificar: /opt/airflow/.env\n2025-06-10 00:09:44,452 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-10 00:09:44]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-10 00:09:44,452 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-10 00:09:44]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-10 00:09:44,452 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-10 00:09:44] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-10 00:09:44,452 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-10 00:09:44] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-10 00:09:44,453 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-10 00:09:44]   ✅ Definido DB_USER do .env\n2025-06-10 00:09:44,453 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-10 00:09:44]   ✅ Definido DB_PASSWORD do .env\n2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-10 00:09:44]   ✅ Definido DB_HOST do .env\n2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-10 00:09:44]   ✅ Definido DB_PORT do .env\n2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-10 00:09:44]   ✅ Definido DB_NAME do .env\n2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-10 00:09:44]   ✅ Definido DB_SCHEMA do .env\n2025-06-10 00:09:44,454 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-10 00:09:44] 🔍 Verificação final da configuração...\n2025-06-10 00:09:44,454 - INFO - 🔍 Verificação final da configuração...\n[2025-06-10 00:09:44]   DB_HOST: DEFINIDO\n2025-06-10 00:09:44,454 - INFO -   DB_HOST: DEFINIDO\n[2025-06-10 00:09:44]   DB_USER: DEFINIDO\n2025-06-10 00:09:44,454 - INFO -   DB_USER: DEFINIDO\n[2025-06-10 00:09:44]   DB_PASSWORD: DEFINIDO\n2025-06-10 00:09:44,454 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-10 00:09:44]   DB_PORT: 6543\n2025-06-10 00:09:44,454 - INFO -   DB_PORT: 6543\n[2025-06-10 00:09:44]   DB_NAME: postgres\n2025-06-10 00:09:44,454 - INFO -   DB_NAME: postgres\n[2025-06-10 00:09:44]   DB_SCHEMA: google_scraper\n2025-06-10 00:09:44,454 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-10 00:09:44] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-10 00:09:44,454 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-10 00:09:44] 🔗 A conectar à base de dados...\n2025-06-10 00:09:44,454 - INFO - 🔗 A conectar à base de dados...\n[2025-06-10 00:09:44] ✅ Conectado à base de dados com sucesso\n2025-06-10 00:09:44,729 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-10 00:09:44] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250610_staging eliminada se existia\n2025-06-10 00:09:44,767 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250610_staging eliminada se existia\n[2025-06-10 00:09:44] ✅ Tabela google_scraper.artigos_filtrados_20250610_staging criada com esquema correto\n2025-06-10 00:09:44,835 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250610_staging criada com esquema correto\n[2025-06-10 00:09:44] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250610_staging\n2025-06-10 00:09:44,921 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250610_staging\n[2025-06-10 00:09:44] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-10 00:09:44,922 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-10 00:09:44] 📅 A converter formatos de data...\n2025-06-10 00:09:44,922 - INFO - 📅 A converter formatos de data...\n[2025-06-10 00:09:44] ✅ Preparadas 26 linhas para inserção\n2025-06-10 00:09:44,925 - INFO - ✅ Preparadas 26 linhas para inserção\n[2025-06-10 00:09:45] ✅ Inseridos/atualizados 26 artigos (falharam: 0)\n2025-06-10 00:09:45,938 - INFO - ✅ Inseridos/atualizados 26 artigos (falharam: 0)\n[2025-06-10 00:09:45] 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv\n2025-06-10 00:09:45,946 - INFO - 💾 Backup de exportação guardado: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv\n[2025-06-10 00:09:45] ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/10/export_stats_20250610.json\n2025-06-10 00:09:45,948 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/data/processed/2025/06/10/export_stats_20250610.json\n[2025-06-10 00:09:45] 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv\n2025-06-10 00:09:45,948 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/data/processed/2025/06/10/export_backup_20250610.csv\n[2025-06-10 00:09:45] ✅ Exportação concluída com sucesso. Inseridos/atualizados 26 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250610_staging\n2025-06-10 00:09:45,948 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 26 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250610_staging\n[2025-06-10 00:09:45] 🔗 Ligação à base de dados fechada\n2025-06-10 00:09:45,948 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-10 00:09:45] ✅ Exportação concluída com sucesso. Processados 26 artigos\n2025-06-10 00:09:45,949 - INFO - ✅ Exportação concluída com sucesso. Processados 26 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
