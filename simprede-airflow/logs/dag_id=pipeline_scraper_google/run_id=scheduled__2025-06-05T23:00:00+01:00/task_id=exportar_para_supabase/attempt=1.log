{"timestamp":"2025-06-06T09:38:55.502717","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-06T09:38:55.503010","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-06T09:38:55.524686Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.524883Z","level":"info","event":"📅 Using current date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.525049Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/06', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/06', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/06']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.525098Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.525144Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.525185Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.525223Z","level":"info","event":"  - Target date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.525258Z","level":"info","event":"  - Database table: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.525294Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.531280Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.531409Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_vitimas_filtrados_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.531785Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_sem_vitimas_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532008Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532117Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1157 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532176Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532239Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1157 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532304Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532369Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json (416 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532434Z","level":"info","event":"📋 Selected input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1157 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532508Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532596Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532639Z","level":"info","event":"  - export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532681Z","level":"info","event":"  - export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532763Z","level":"info","event":"  - backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532843Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/scripts/google_scraper/data/processed/2025/06/06 --date_str 2025-06-06 --input_file /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv --date 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:55.532921Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.432681Z","level":"info","event":"📋 [2025-06-06 10:38:56] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.433052Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.433320Z","level":"info","event":"📋 [2025-06-06 10:38:56] Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.433459Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434368Z","level":"info","event":"📋 [2025-06-06 10:38:56] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434447Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434513Z","level":"info","event":"📋 [2025-06-06 10:38:56] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434570Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434625Z","level":"info","event":"📋 [2025-06-06 10:38:56] 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434676Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434727Z","level":"info","event":"📋 [2025-06-06 10:38:56] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434781Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434834Z","level":"info","event":"📋 [2025-06-06 10:38:56] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434937Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.434989Z","level":"info","event":"📋 [2025-06-06 10:38:56] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435042Z","level":"info","event":"📋 2025-06-06 10:38:56,432 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435115Z","level":"info","event":"📋 [2025-06-06 10:38:56] 📊 Carregados 4 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435175Z","level":"info","event":"📋 2025-06-06 10:38:56,434 - INFO - 📊 Carregados 4 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435229Z","level":"info","event":"📋 [2025-06-06 10:38:56] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435277Z","level":"info","event":"📋 2025-06-06 10:38:56,434 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435337Z","level":"info","event":"📋 [2025-06-06 10:38:56] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435443Z","level":"info","event":"📋 2025-06-06 10:38:56,435 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435551Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435610Z","level":"info","event":"📋 2025-06-06 10:38:56,435 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435665Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435731Z","level":"info","event":"📋 2025-06-06 10:38:56,435 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435789Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.435887Z","level":"info","event":"📋 2025-06-06 10:38:56,435 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.436071Z","level":"info","event":"📋 [2025-06-06 10:38:56] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.436150Z","level":"info","event":"📋 2025-06-06 10:38:56,435 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.436248Z","level":"info","event":"📋 [2025-06-06 10:38:56] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.436312Z","level":"info","event":"📋 2025-06-06 10:38:56,435 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.436546Z","level":"info","event":"📋 [2025-06-06 10:38:56]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.436632Z","level":"info","event":"📋 2025-06-06 10:38:56,435 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437013Z","level":"info","event":"📋 [2025-06-06 10:38:56]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437070Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437131Z","level":"info","event":"📋 [2025-06-06 10:38:56]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437172Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437211Z","level":"info","event":"📋 [2025-06-06 10:38:56] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437538Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437586Z","level":"info","event":"📋 [2025-06-06 10:38:56] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437627Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437669Z","level":"info","event":"📋 [2025-06-06 10:38:56]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437710Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437750Z","level":"info","event":"📋 [2025-06-06 10:38:56]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437786Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437821Z","level":"info","event":"📋 [2025-06-06 10:38:56]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.437856Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438108Z","level":"info","event":"📋 [2025-06-06 10:38:56]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438212Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438273Z","level":"info","event":"📋 [2025-06-06 10:38:56]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438340Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438486Z","level":"info","event":"📋 [2025-06-06 10:38:56]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438553Z","level":"info","event":"📋 2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438646Z","level":"info","event":"📋 [2025-06-06 10:38:56] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438729Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438839Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.438969Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439017Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439054Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439092Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439128Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439163Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439200Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439235Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439274Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439322Z","level":"info","event":"📋 [2025-06-06 10:38:56]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439401Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439534Z","level":"info","event":"📋 [2025-06-06 10:38:56] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439640Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439736Z","level":"info","event":"📋 [2025-06-06 10:38:56] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:56.439811Z","level":"info","event":"📋 2025-06-06 10:38:56,437 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:57.322929Z","level":"info","event":"📋 [2025-06-06 10:38:57] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:57.323411Z","level":"info","event":"📋 2025-06-06 10:38:57,322 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:57.534934Z","level":"info","event":"📋 [2025-06-06 10:38:57] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:57.535535Z","level":"info","event":"📋 2025-06-06 10:38:57,534 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:57.789884Z","level":"info","event":"📋 [2025-06-06 10:38:57] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:57.790663Z","level":"info","event":"📋 2025-06-06 10:38:57,789 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.059099Z","level":"info","event":"📋 [2025-06-06 10:38:58] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.063721Z","level":"info","event":"📋 2025-06-06 10:38:58,058 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.064167Z","level":"info","event":"📋 [2025-06-06 10:38:58] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.065407Z","level":"info","event":"📋 2025-06-06 10:38:58,059 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.065638Z","level":"info","event":"📋 [2025-06-06 10:38:58] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.065821Z","level":"info","event":"📋 2025-06-06 10:38:58,060 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.067440Z","level":"info","event":"📋 [2025-06-06 10:38:58] ✅ Preparadas 4 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.067747Z","level":"info","event":"📋 2025-06-06 10:38:58,067 - INFO - ✅ Preparadas 4 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.846744Z","level":"info","event":"📋 [2025-06-06 10:38:58] ✅ Inseridos/atualizados 4 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.848578Z","level":"info","event":"📋 2025-06-06 10:38:58,846 - INFO - ✅ Inseridos/atualizados 4 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.855351Z","level":"info","event":"📋 [2025-06-06 10:38:58] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.855895Z","level":"info","event":"📋 2025-06-06 10:38:58,855 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.857566Z","level":"info","event":"📋 [2025-06-06 10:38:58] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.861555Z","level":"info","event":"📋 2025-06-06 10:38:58,857 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.863633Z","level":"info","event":"📋 [2025-06-06 10:38:58] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.864019Z","level":"info","event":"📋 2025-06-06 10:38:58,857 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.864275Z","level":"info","event":"📋 [2025-06-06 10:38:58] ✅ Exportação concluída com sucesso. Inseridos/atualizados 4 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.864854Z","level":"info","event":"📋 2025-06-06 10:38:58,857 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 4 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.865809Z","level":"info","event":"📋 [2025-06-06 10:38:58] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.865945Z","level":"info","event":"📋 2025-06-06 10:38:58,857 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.866059Z","level":"info","event":"📋 [2025-06-06 10:38:58] ✅ Exportação concluída com sucesso. Processados 4 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.866180Z","level":"info","event":"📋 2025-06-06 10:38:58,858 - INFO - ✅ Exportação concluída com sucesso. Processados 4 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.952707Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.952886Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.953105Z","level":"info","event":"⚠️ export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.953246Z","level":"info","event":"✅ export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json (929 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.953366Z","level":"info","event":"✅ backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv (1158 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T09:38:58.953769","level":"info","event":"Done. Returned value was: [2025-06-06 10:38:56] A iniciar export_to_supabase_airflow\n2025-06-06 10:38:56,432 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-06 10:38:56] Parâmetros: date=2025-06-06\n2025-06-06 10:38:56,432 - INFO - Parâmetros: date=2025-06-06\n[2025-06-06 10:38:56] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n2025-06-06 10:38:56,432 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n[2025-06-06 10:38:56] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n2025-06-06 10:38:56,432 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n[2025-06-06 10:38:56] 📋 Tabela de destino: artigos_filtrados_20250606_staging\n2025-06-06 10:38:56,432 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging\n[2025-06-06 10:38:56] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n2025-06-06 10:38:56,432 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n[2025-06-06 10:38:56] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 10:38:56,432 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 10:38:56] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 10:38:56,432 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 10:38:56] 📊 Carregados 4 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-06 10:38:56,434 - INFO - 📊 Carregados 4 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-06 10:38:56] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-06 10:38:56,434 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-06 10:38:56] 🔍 Verificação inicial do ambiente...\n2025-06-06 10:38:56,435 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-06 10:38:56]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-06 10:38:56,435 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-06 10:38:56]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-06 10:38:56,435 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-06 10:38:56]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-06 10:38:56,435 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-06 10:38:56] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-06 10:38:56,435 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-06 10:38:56] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-06 10:38:56,435 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-06 10:38:56]   A verificar: /opt/airflow/.env\n2025-06-06 10:38:56,435 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-06 10:38:56]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-06 10:38:56,436 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-06 10:38:56]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 10:38:56,436 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 10:38:56] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 10:38:56,436 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 10:38:56] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-06 10:38:56,436 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-06 10:38:56]   ✅ Definido DB_USER do .env\n2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-06 10:38:56]   ✅ Definido DB_PASSWORD do .env\n2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-06 10:38:56]   ✅ Definido DB_HOST do .env\n2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-06 10:38:56]   ✅ Definido DB_PORT do .env\n2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-06 10:38:56]   ✅ Definido DB_NAME do .env\n2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-06 10:38:56]   ✅ Definido DB_SCHEMA do .env\n2025-06-06 10:38:56,436 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-06 10:38:56] 🔍 Verificação final da configuração...\n2025-06-06 10:38:56,437 - INFO - 🔍 Verificação final da configuração...\n[2025-06-06 10:38:56]   DB_HOST: DEFINIDO\n2025-06-06 10:38:56,437 - INFO -   DB_HOST: DEFINIDO\n[2025-06-06 10:38:56]   DB_USER: DEFINIDO\n2025-06-06 10:38:56,437 - INFO -   DB_USER: DEFINIDO\n[2025-06-06 10:38:56]   DB_PASSWORD: DEFINIDO\n2025-06-06 10:38:56,437 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-06 10:38:56]   DB_PORT: 6543\n2025-06-06 10:38:56,437 - INFO -   DB_PORT: 6543\n[2025-06-06 10:38:56]   DB_NAME: postgres\n2025-06-06 10:38:56,437 - INFO -   DB_NAME: postgres\n[2025-06-06 10:38:56]   DB_SCHEMA: google_scraper\n2025-06-06 10:38:56,437 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-06 10:38:56] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-06 10:38:56,437 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-06 10:38:56] 🔗 A conectar à base de dados...\n2025-06-06 10:38:56,437 - INFO - 🔗 A conectar à base de dados...\n[2025-06-06 10:38:57] ✅ Conectado à base de dados com sucesso\n2025-06-06 10:38:57,322 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-06 10:38:57] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n2025-06-06 10:38:57,534 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n[2025-06-06 10:38:57] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n2025-06-06 10:38:57,789 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n[2025-06-06 10:38:58] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n2025-06-06 10:38:58,058 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n[2025-06-06 10:38:58] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-06 10:38:58,059 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-06 10:38:58] 📅 A converter formatos de data...\n2025-06-06 10:38:58,060 - INFO - 📅 A converter formatos de data...\n[2025-06-06 10:38:58] ✅ Preparadas 4 linhas para inserção\n2025-06-06 10:38:58,067 - INFO - ✅ Preparadas 4 linhas para inserção\n[2025-06-06 10:38:58] ✅ Inseridos/atualizados 4 artigos (falharam: 0)\n2025-06-06 10:38:58,846 - INFO - ✅ Inseridos/atualizados 4 artigos (falharam: 0)\n[2025-06-06 10:38:58] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 10:38:58,855 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 10:38:58] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n2025-06-06 10:38:58,857 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n[2025-06-06 10:38:58] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 10:38:58,857 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 10:38:58] ✅ Exportação concluída com sucesso. Inseridos/atualizados 4 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n2025-06-06 10:38:58,857 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 4 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n[2025-06-06 10:38:58] 🔗 Ligação à base de dados fechada\n2025-06-06 10:38:58,857 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-06 10:38:58] ✅ Exportação concluída com sucesso. Processados 4 artigos\n2025-06-06 10:38:58,858 - INFO - ✅ Exportação concluída com sucesso. Processados 4 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
{"timestamp":"2025-06-06T11:04:01.767222","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-06T11:04:01.767730","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-06T11:04:01.803571Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.803899Z","level":"info","event":"📅 Using current date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.804174Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/06', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/06', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/06']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.804247Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.804288Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.804325Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.804362Z","level":"info","event":"  - Target date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.804401Z","level":"info","event":"  - Database table: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.804437Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.811135Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.811258Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_vitimas_filtrados_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.811742Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_sem_vitimas_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812110Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812258Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1413 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812331Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812391Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1413 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812454Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812536Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json (416 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812624Z","level":"info","event":"📋 Selected input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1413 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812695Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812765Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812833Z","level":"info","event":"  - export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.812900Z","level":"info","event":"  - export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.813032Z","level":"info","event":"  - backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.813105Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/scripts/google_scraper/data/processed/2025/06/06 --date_str 2025-06-06 --input_file /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv --date 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:01.813198Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.775738Z","level":"info","event":"📋 [2025-06-06 12:04:02] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.776065Z","level":"info","event":"📋 2025-06-06 12:04:02,775 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.776476Z","level":"info","event":"📋 [2025-06-06 12:04:02] Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.776704Z","level":"info","event":"📋 2025-06-06 12:04:02,775 - INFO - Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.776766Z","level":"info","event":"📋 [2025-06-06 12:04:02] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.776821Z","level":"info","event":"📋 2025-06-06 12:04:02,775 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.776895Z","level":"info","event":"📋 [2025-06-06 12:04:02] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778040Z","level":"info","event":"📋 2025-06-06 12:04:02,775 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778100Z","level":"info","event":"📋 [2025-06-06 12:04:02] 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778148Z","level":"info","event":"📋 2025-06-06 12:04:02,775 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778195Z","level":"info","event":"📋 [2025-06-06 12:04:02] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778254Z","level":"info","event":"📋 2025-06-06 12:04:02,775 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778361Z","level":"info","event":"📋 [2025-06-06 12:04:02] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778416Z","level":"info","event":"📋 2025-06-06 12:04:02,776 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778472Z","level":"info","event":"📋 [2025-06-06 12:04:02] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778591Z","level":"info","event":"📋 2025-06-06 12:04:02,776 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778644Z","level":"info","event":"📋 [2025-06-06 12:04:02] 📊 Carregados 5 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778711Z","level":"info","event":"📋 2025-06-06 12:04:02,778 - INFO - 📊 Carregados 5 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778758Z","level":"info","event":"📋 [2025-06-06 12:04:02] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778806Z","level":"info","event":"📋 2025-06-06 12:04:02,778 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778861Z","level":"info","event":"📋 [2025-06-06 12:04:02] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.778973Z","level":"info","event":"📋 2025-06-06 12:04:02,778 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779029Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779075Z","level":"info","event":"📋 2025-06-06 12:04:02,778 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779130Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779177Z","level":"info","event":"📋 2025-06-06 12:04:02,779 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779229Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779282Z","level":"info","event":"📋 2025-06-06 12:04:02,779 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779356Z","level":"info","event":"📋 [2025-06-06 12:04:02] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779414Z","level":"info","event":"📋 2025-06-06 12:04:02,779 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779529Z","level":"info","event":"📋 [2025-06-06 12:04:02] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779575Z","level":"info","event":"📋 2025-06-06 12:04:02,779 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779637Z","level":"info","event":"📋 [2025-06-06 12:04:02]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.779793Z","level":"info","event":"📋 2025-06-06 12:04:02,779 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.780907Z","level":"info","event":"📋 [2025-06-06 12:04:02]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.781027Z","level":"info","event":"📋 2025-06-06 12:04:02,780 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.781102Z","level":"info","event":"📋 [2025-06-06 12:04:02]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.783464Z","level":"info","event":"📋 2025-06-06 12:04:02,780 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.783646Z","level":"info","event":"📋 [2025-06-06 12:04:02] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784287Z","level":"info","event":"📋 2025-06-06 12:04:02,780 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784369Z","level":"info","event":"📋 [2025-06-06 12:04:02] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784463Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784555Z","level":"info","event":"📋 [2025-06-06 12:04:02]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784627Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784700Z","level":"info","event":"📋 [2025-06-06 12:04:02]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784774Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784844Z","level":"info","event":"📋 [2025-06-06 12:04:02]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.784926Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785018Z","level":"info","event":"📋 [2025-06-06 12:04:02]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785099Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785169Z","level":"info","event":"📋 [2025-06-06 12:04:02]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785229Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785286Z","level":"info","event":"📋 [2025-06-06 12:04:02]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785362Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785496Z","level":"info","event":"📋 [2025-06-06 12:04:02] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785558Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785600Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785734Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785806Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785899Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.785967Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786019Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786095Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786158Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786233Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786299Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786357Z","level":"info","event":"📋 [2025-06-06 12:04:02]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786409Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786471Z","level":"info","event":"📋 [2025-06-06 12:04:02] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786520Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786584Z","level":"info","event":"📋 [2025-06-06 12:04:02] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:02.786647Z","level":"info","event":"📋 2025-06-06 12:04:02,783 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.275324Z","level":"info","event":"📋 [2025-06-06 12:04:03] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.275757Z","level":"info","event":"📋 2025-06-06 12:04:03,275 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.451541Z","level":"info","event":"📋 [2025-06-06 12:04:03] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.452300Z","level":"info","event":"📋 2025-06-06 12:04:03,451 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.567760Z","level":"info","event":"📋 [2025-06-06 12:04:03] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.568634Z","level":"info","event":"📋 2025-06-06 12:04:03,567 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.688864Z","level":"info","event":"📋 [2025-06-06 12:04:03] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.695229Z","level":"info","event":"📋 2025-06-06 12:04:03,688 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.696053Z","level":"info","event":"📋 [2025-06-06 12:04:03] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.696464Z","level":"info","event":"📋 2025-06-06 12:04:03,688 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.696948Z","level":"info","event":"📋 [2025-06-06 12:04:03] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.697702Z","level":"info","event":"📋 2025-06-06 12:04:03,689 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.698161Z","level":"info","event":"📋 [2025-06-06 12:04:03] ✅ Preparadas 5 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:03.698364Z","level":"info","event":"📋 2025-06-06 12:04:03,696 - INFO - ✅ Preparadas 5 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.035206Z","level":"info","event":"📋 [2025-06-06 12:04:04] ✅ Inseridos/atualizados 5 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.037456Z","level":"info","event":"📋 2025-06-06 12:04:04,034 - INFO - ✅ Inseridos/atualizados 5 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.045353Z","level":"info","event":"📋 [2025-06-06 12:04:04] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.046109Z","level":"info","event":"📋 2025-06-06 12:04:04,045 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.046930Z","level":"info","event":"📋 [2025-06-06 12:04:04] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.051142Z","level":"info","event":"📋 2025-06-06 12:04:04,046 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054017Z","level":"info","event":"📋 [2025-06-06 12:04:04] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054167Z","level":"info","event":"📋 2025-06-06 12:04:04,046 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054281Z","level":"info","event":"📋 [2025-06-06 12:04:04] ✅ Exportação concluída com sucesso. Inseridos/atualizados 5 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054374Z","level":"info","event":"📋 2025-06-06 12:04:04,046 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 5 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054465Z","level":"info","event":"📋 [2025-06-06 12:04:04] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054549Z","level":"info","event":"📋 2025-06-06 12:04:04,047 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054761Z","level":"info","event":"📋 [2025-06-06 12:04:04] ✅ Exportação concluída com sucesso. Processados 5 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.054902Z","level":"info","event":"📋 2025-06-06 12:04:04,047 - INFO - ✅ Exportação concluída com sucesso. Processados 5 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.152751Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.153016Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.153206Z","level":"info","event":"⚠️ export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.153286Z","level":"info","event":"✅ export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json (929 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.153372Z","level":"info","event":"✅ backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv (1413 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T11:04:04.154160","level":"info","event":"Done. Returned value was: [2025-06-06 12:04:02] A iniciar export_to_supabase_airflow\n2025-06-06 12:04:02,775 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-06 12:04:02] Parâmetros: date=2025-06-06\n2025-06-06 12:04:02,775 - INFO - Parâmetros: date=2025-06-06\n[2025-06-06 12:04:02] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n2025-06-06 12:04:02,775 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n[2025-06-06 12:04:02] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n2025-06-06 12:04:02,775 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n[2025-06-06 12:04:02] 📋 Tabela de destino: artigos_filtrados_20250606_staging\n2025-06-06 12:04:02,775 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging\n[2025-06-06 12:04:02] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n2025-06-06 12:04:02,775 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n[2025-06-06 12:04:02] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 12:04:02,776 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 12:04:02] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 12:04:02,776 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 12:04:02] 📊 Carregados 5 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-06 12:04:02,778 - INFO - 📊 Carregados 5 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-06 12:04:02] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-06 12:04:02,778 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-06 12:04:02] 🔍 Verificação inicial do ambiente...\n2025-06-06 12:04:02,778 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-06 12:04:02]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-06 12:04:02,778 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-06 12:04:02]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-06 12:04:02,779 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-06 12:04:02]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-06 12:04:02,779 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-06 12:04:02] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-06 12:04:02,779 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-06 12:04:02] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-06 12:04:02,779 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-06 12:04:02]   A verificar: /opt/airflow/.env\n2025-06-06 12:04:02,779 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-06 12:04:02]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-06 12:04:02,780 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-06 12:04:02]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 12:04:02,780 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 12:04:02] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 12:04:02,780 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 12:04:02] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-06 12:04:02,783 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-06 12:04:02]   ✅ Definido DB_USER do .env\n2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-06 12:04:02]   ✅ Definido DB_PASSWORD do .env\n2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-06 12:04:02]   ✅ Definido DB_HOST do .env\n2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-06 12:04:02]   ✅ Definido DB_PORT do .env\n2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-06 12:04:02]   ✅ Definido DB_NAME do .env\n2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-06 12:04:02]   ✅ Definido DB_SCHEMA do .env\n2025-06-06 12:04:02,783 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-06 12:04:02] 🔍 Verificação final da configuração...\n2025-06-06 12:04:02,783 - INFO - 🔍 Verificação final da configuração...\n[2025-06-06 12:04:02]   DB_HOST: DEFINIDO\n2025-06-06 12:04:02,783 - INFO -   DB_HOST: DEFINIDO\n[2025-06-06 12:04:02]   DB_USER: DEFINIDO\n2025-06-06 12:04:02,783 - INFO -   DB_USER: DEFINIDO\n[2025-06-06 12:04:02]   DB_PASSWORD: DEFINIDO\n2025-06-06 12:04:02,783 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-06 12:04:02]   DB_PORT: 6543\n2025-06-06 12:04:02,783 - INFO -   DB_PORT: 6543\n[2025-06-06 12:04:02]   DB_NAME: postgres\n2025-06-06 12:04:02,783 - INFO -   DB_NAME: postgres\n[2025-06-06 12:04:02]   DB_SCHEMA: google_scraper\n2025-06-06 12:04:02,783 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-06 12:04:02] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-06 12:04:02,783 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-06 12:04:02] 🔗 A conectar à base de dados...\n2025-06-06 12:04:02,783 - INFO - 🔗 A conectar à base de dados...\n[2025-06-06 12:04:03] ✅ Conectado à base de dados com sucesso\n2025-06-06 12:04:03,275 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-06 12:04:03] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n2025-06-06 12:04:03,451 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n[2025-06-06 12:04:03] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n2025-06-06 12:04:03,567 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n[2025-06-06 12:04:03] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n2025-06-06 12:04:03,688 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n[2025-06-06 12:04:03] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-06 12:04:03,688 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-06 12:04:03] 📅 A converter formatos de data...\n2025-06-06 12:04:03,689 - INFO - 📅 A converter formatos de data...\n[2025-06-06 12:04:03] ✅ Preparadas 5 linhas para inserção\n2025-06-06 12:04:03,696 - INFO - ✅ Preparadas 5 linhas para inserção\n[2025-06-06 12:04:04] ✅ Inseridos/atualizados 5 artigos (falharam: 0)\n2025-06-06 12:04:04,034 - INFO - ✅ Inseridos/atualizados 5 artigos (falharam: 0)\n[2025-06-06 12:04:04] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 12:04:04,045 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 12:04:04] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n2025-06-06 12:04:04,046 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n[2025-06-06 12:04:04] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 12:04:04,046 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 12:04:04] ✅ Exportação concluída com sucesso. Inseridos/atualizados 5 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n2025-06-06 12:04:04,046 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 5 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n[2025-06-06 12:04:04] 🔗 Ligação à base de dados fechada\n2025-06-06 12:04:04,047 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-06 12:04:04] ✅ Exportação concluída com sucesso. Processados 5 artigos\n2025-06-06 12:04:04,047 - INFO - ✅ Exportação concluída com sucesso. Processados 5 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
{"timestamp":"2025-06-06T13:59:36.018467","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-06T13:59:36.019037","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-06T13:59:36.059013Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.059189Z","level":"info","event":"📅 Using current date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.059545Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/06', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/06', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/06']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.059666Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.059800Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.059864Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.059926Z","level":"info","event":"  - Target date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.059984Z","level":"info","event":"  - Database table: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.060072Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.071312Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.071470Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_vitimas_filtrados_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.071647Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_sem_vitimas_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.071765Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.071870Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1870 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.071971Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072097Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1870 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072231Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072380Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json (416 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072509Z","level":"info","event":"📋 Selected input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (1870 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072627Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072784Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072884Z","level":"info","event":"  - export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.072982Z","level":"info","event":"  - export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.073073Z","level":"info","event":"  - backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.073165Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/scripts/google_scraper/data/processed/2025/06/06 --date_str 2025-06-06 --input_file /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv --date 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:36.073378Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.619437Z","level":"info","event":"📋 [2025-06-06 14:59:37] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.620864Z","level":"info","event":"📋 2025-06-06 14:59:37,618 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.621032Z","level":"info","event":"📋 [2025-06-06 14:59:37] Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.621149Z","level":"info","event":"📋 2025-06-06 14:59:37,619 - INFO - Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.621366Z","level":"info","event":"📋 [2025-06-06 14:59:37] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.621679Z","level":"info","event":"📋 2025-06-06 14:59:37,619 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.621783Z","level":"info","event":"📋 [2025-06-06 14:59:37] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.621885Z","level":"info","event":"📋 2025-06-06 14:59:37,619 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.621990Z","level":"info","event":"📋 [2025-06-06 14:59:37] 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.622097Z","level":"info","event":"📋 2025-06-06 14:59:37,619 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.622196Z","level":"info","event":"📋 [2025-06-06 14:59:37] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.622293Z","level":"info","event":"📋 2025-06-06 14:59:37,619 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.622369Z","level":"info","event":"📋 [2025-06-06 14:59:37] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.622469Z","level":"info","event":"📋 2025-06-06 14:59:37,619 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.622576Z","level":"info","event":"📋 [2025-06-06 14:59:37] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.622672Z","level":"info","event":"📋 2025-06-06 14:59:37,619 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.623597Z","level":"info","event":"📋 [2025-06-06 14:59:37] 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.623749Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO - 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.623918Z","level":"info","event":"📋 [2025-06-06 14:59:37] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624092Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624264Z","level":"info","event":"📋 [2025-06-06 14:59:37] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624502Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624592Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624680Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624748Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624838Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.624946Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625046Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625129Z","level":"info","event":"📋 [2025-06-06 14:59:37] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625236Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625351Z","level":"info","event":"📋 [2025-06-06 14:59:37] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625440Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625524Z","level":"info","event":"📋 [2025-06-06 14:59:37]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625608Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625743Z","level":"info","event":"📋 [2025-06-06 14:59:37]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.625899Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.626088Z","level":"info","event":"📋 [2025-06-06 14:59:37]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.626221Z","level":"info","event":"📋 2025-06-06 14:59:37,623 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.626440Z","level":"info","event":"📋 [2025-06-06 14:59:37] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.626631Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.626773Z","level":"info","event":"📋 [2025-06-06 14:59:37] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.626884Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.626975Z","level":"info","event":"📋 [2025-06-06 14:59:37]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627051Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627177Z","level":"info","event":"📋 [2025-06-06 14:59:37]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627361Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627529Z","level":"info","event":"📋 [2025-06-06 14:59:37]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627698Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627763Z","level":"info","event":"📋 [2025-06-06 14:59:37]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627822Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627883Z","level":"info","event":"📋 [2025-06-06 14:59:37]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627939Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.627995Z","level":"info","event":"📋 [2025-06-06 14:59:37]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628052Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628118Z","level":"info","event":"📋 [2025-06-06 14:59:37] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628190Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628282Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628358Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628419Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628480Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628582Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628648Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628705Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628761Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628817Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628875Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628930Z","level":"info","event":"📋 [2025-06-06 14:59:37]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.628992Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.629047Z","level":"info","event":"📋 [2025-06-06 14:59:37] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.629105Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.629160Z","level":"info","event":"📋 [2025-06-06 14:59:37] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:37.629216Z","level":"info","event":"📋 2025-06-06 14:59:37,624 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.089198Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.089603Z","level":"info","event":"📋 2025-06-06 14:59:38,088 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.268262Z","level":"info","event":"📋 [2025-06-06 14:59:38] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.268578Z","level":"info","event":"📋 2025-06-06 14:59:38,267 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.376233Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.376480Z","level":"info","event":"📋 2025-06-06 14:59:38,376 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.505248Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.505473Z","level":"info","event":"📋 2025-06-06 14:59:38,505 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.505671Z","level":"info","event":"📋 [2025-06-06 14:59:38] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.505798Z","level":"info","event":"📋 2025-06-06 14:59:38,505 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.505952Z","level":"info","event":"📋 [2025-06-06 14:59:38] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.506041Z","level":"info","event":"📋 2025-06-06 14:59:38,505 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.509344Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Preparadas 7 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.509477Z","level":"info","event":"📋 2025-06-06 14:59:38,509 - INFO - ✅ Preparadas 7 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.921061Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Inseridos/atualizados 7 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.921566Z","level":"info","event":"📋 2025-06-06 14:59:38,920 - INFO - ✅ Inseridos/atualizados 7 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.928490Z","level":"info","event":"📋 [2025-06-06 14:59:38] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.929153Z","level":"info","event":"📋 2025-06-06 14:59:38,928 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.930260Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.930634Z","level":"info","event":"📋 2025-06-06 14:59:38,930 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.931997Z","level":"info","event":"📋 [2025-06-06 14:59:38] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.932240Z","level":"info","event":"📋 2025-06-06 14:59:38,930 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.932657Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.932904Z","level":"info","event":"📋 2025-06-06 14:59:38,930 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.933287Z","level":"info","event":"📋 [2025-06-06 14:59:38] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.933518Z","level":"info","event":"📋 2025-06-06 14:59:38,931 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.933748Z","level":"info","event":"📋 [2025-06-06 14:59:38] ✅ Exportação concluída com sucesso. Processados 7 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:38.933943Z","level":"info","event":"📋 2025-06-06 14:59:38,932 - INFO - ✅ Exportação concluída com sucesso. Processados 7 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:39.080446Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:39.080791Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:39.081096Z","level":"info","event":"⚠️ export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:39.081460Z","level":"info","event":"✅ export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json (929 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:39.081725Z","level":"info","event":"✅ backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv (1868 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T13:59:39.083649","level":"info","event":"Done. Returned value was: [2025-06-06 14:59:37] A iniciar export_to_supabase_airflow\n2025-06-06 14:59:37,618 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-06 14:59:37] Parâmetros: date=2025-06-06\n2025-06-06 14:59:37,619 - INFO - Parâmetros: date=2025-06-06\n[2025-06-06 14:59:37] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n2025-06-06 14:59:37,619 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n[2025-06-06 14:59:37] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n2025-06-06 14:59:37,619 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n[2025-06-06 14:59:37] 📋 Tabela de destino: artigos_filtrados_20250606_staging\n2025-06-06 14:59:37,619 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging\n[2025-06-06 14:59:37] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n2025-06-06 14:59:37,619 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n[2025-06-06 14:59:37] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 14:59:37,619 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 14:59:37] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 14:59:37,619 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 14:59:37] 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-06 14:59:37,623 - INFO - 📊 Carregados 7 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-06 14:59:37] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-06 14:59:37,623 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-06 14:59:37] 🔍 Verificação inicial do ambiente...\n2025-06-06 14:59:37,623 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-06 14:59:37]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-06 14:59:37,623 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-06 14:59:37]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-06 14:59:37,623 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-06 14:59:37]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-06 14:59:37,623 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-06 14:59:37] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-06 14:59:37,623 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-06 14:59:37] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-06 14:59:37,623 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-06 14:59:37]   A verificar: /opt/airflow/.env\n2025-06-06 14:59:37,623 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-06 14:59:37]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-06 14:59:37,623 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-06 14:59:37]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 14:59:37,623 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 14:59:37] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 14:59:37,624 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 14:59:37] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-06 14:59:37,624 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-06 14:59:37]   ✅ Definido DB_USER do .env\n2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-06 14:59:37]   ✅ Definido DB_PASSWORD do .env\n2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-06 14:59:37]   ✅ Definido DB_HOST do .env\n2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-06 14:59:37]   ✅ Definido DB_PORT do .env\n2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-06 14:59:37]   ✅ Definido DB_NAME do .env\n2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-06 14:59:37]   ✅ Definido DB_SCHEMA do .env\n2025-06-06 14:59:37,624 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-06 14:59:37] 🔍 Verificação final da configuração...\n2025-06-06 14:59:37,624 - INFO - 🔍 Verificação final da configuração...\n[2025-06-06 14:59:37]   DB_HOST: DEFINIDO\n2025-06-06 14:59:37,624 - INFO -   DB_HOST: DEFINIDO\n[2025-06-06 14:59:37]   DB_USER: DEFINIDO\n2025-06-06 14:59:37,624 - INFO -   DB_USER: DEFINIDO\n[2025-06-06 14:59:37]   DB_PASSWORD: DEFINIDO\n2025-06-06 14:59:37,624 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-06 14:59:37]   DB_PORT: 6543\n2025-06-06 14:59:37,624 - INFO -   DB_PORT: 6543\n[2025-06-06 14:59:37]   DB_NAME: postgres\n2025-06-06 14:59:37,624 - INFO -   DB_NAME: postgres\n[2025-06-06 14:59:37]   DB_SCHEMA: google_scraper\n2025-06-06 14:59:37,624 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-06 14:59:37] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-06 14:59:37,624 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-06 14:59:37] 🔗 A conectar à base de dados...\n2025-06-06 14:59:37,624 - INFO - 🔗 A conectar à base de dados...\n[2025-06-06 14:59:38] ✅ Conectado à base de dados com sucesso\n2025-06-06 14:59:38,088 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-06 14:59:38] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n2025-06-06 14:59:38,267 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n[2025-06-06 14:59:38] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n2025-06-06 14:59:38,376 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n[2025-06-06 14:59:38] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n2025-06-06 14:59:38,505 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n[2025-06-06 14:59:38] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-06 14:59:38,505 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-06 14:59:38] 📅 A converter formatos de data...\n2025-06-06 14:59:38,505 - INFO - 📅 A converter formatos de data...\n[2025-06-06 14:59:38] ✅ Preparadas 7 linhas para inserção\n2025-06-06 14:59:38,509 - INFO - ✅ Preparadas 7 linhas para inserção\n[2025-06-06 14:59:38] ✅ Inseridos/atualizados 7 artigos (falharam: 0)\n2025-06-06 14:59:38,920 - INFO - ✅ Inseridos/atualizados 7 artigos (falharam: 0)\n[2025-06-06 14:59:38] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 14:59:38,928 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 14:59:38] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n2025-06-06 14:59:38,930 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n[2025-06-06 14:59:38] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 14:59:38,930 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 14:59:38] ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n2025-06-06 14:59:38,930 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 7 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n[2025-06-06 14:59:38] 🔗 Ligação à base de dados fechada\n2025-06-06 14:59:38,931 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-06 14:59:38] ✅ Exportação concluída com sucesso. Processados 7 artigos\n2025-06-06 14:59:38,932 - INFO - ✅ Exportação concluída com sucesso. Processados 7 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
{"timestamp":"2025-06-06T14:16:10.735221","level":"info","event":"DAG bundles loaded: dags-folder","logger":"airflow.dag_processing.bundles.manager.DagBundlesManager"}
{"timestamp":"2025-06-06T14:16:10.735714","level":"info","event":"Filling up the DagBag from /opt/airflow/dags/google_scraper_dag.py","logger":"airflow.models.dagbag.DagBag"}
{"timestamp":"2025-06-06T14:16:10.775124Z","level":"info","event":"🔄 Starting export_supabase task","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.775497Z","level":"info","event":"📅 Using current date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.776047Z","level":"info","event":"📁 Ensured directories exist: ['/opt/airflow/scripts/google_scraper/data/raw/2025/06/06', '/opt/airflow/scripts/google_scraper/data/structured/2025/06/06', '/opt/airflow/scripts/google_scraper/data/processed/2025/06/06']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.776130Z","level":"info","event":"📅 Export Parameters:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.776195Z","level":"info","event":"  - Days: 1","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.776257Z","level":"info","event":"  - Specific date: None (use execution_date)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.776317Z","level":"info","event":"  - Target date: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.776376Z","level":"info","event":"  - Database table: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.776492Z","level":"info","event":"📁 Input/Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.786309Z","level":"info","event":"📋 Found 2 files from processar task via XCom","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.786482Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_vitimas_filtrados_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.786646Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/artigos_sem_vitimas_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.787530Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.787971Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (3808 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788076Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788165Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (3808 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788267Z","level":"info","event":"🔍 Checking for input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788411Z","level":"info","event":"✅ Found file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/processing_stats_20250606.json (416 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788595Z","level":"info","event":"📋 Selected input file: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv (3808 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788709Z","level":"info","event":"📊 Processing all relevant disaster-related articles","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788800Z","level":"info","event":"📁 Output paths:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788892Z","level":"info","event":"  - export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.788984Z","level":"info","event":"  - export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.789064Z","level":"info","event":"  - backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.789132Z","level":"info","event":"🔄 Running export command: python /opt/airflow/scripts/google_scraper/exportador_bd/export_to_supabase_airflow.py --output_dir /opt/airflow/scripts/google_scraper/data/processed/2025/06/06 --date_str 2025-06-06 --input_file /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv --date 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:10.789239Z","level":"info","event":"⏰ Waiting for export completion with timeout: 600 seconds","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.329637Z","level":"info","event":"📋 [2025-06-06 15:16:12] A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.332902Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - A iniciar export_to_supabase_airflow","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.333062Z","level":"info","event":"📋 [2025-06-06 15:16:12] Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.334636Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - Parâmetros: date=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.334733Z","level":"info","event":"📋 [2025-06-06 15:16:12] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.334803Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.334869Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.334930Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.334989Z","level":"info","event":"📋 [2025-06-06 15:16:12] 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335047Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335107Z","level":"info","event":"📋 [2025-06-06 15:16:12] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335164Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335223Z","level":"info","event":"📋 [2025-06-06 15:16:12] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335283Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335346Z","level":"info","event":"📋 [2025-06-06 15:16:12] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335403Z","level":"info","event":"📋 2025-06-06 15:16:12,329 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335498Z","level":"info","event":"📋 [2025-06-06 15:16:12] 📊 Carregados 15 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335660Z","level":"info","event":"📋 2025-06-06 15:16:12,335 - INFO - 📊 Carregados 15 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335799Z","level":"info","event":"📋 [2025-06-06 15:16:12] 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.335953Z","level":"info","event":"📋 2025-06-06 15:16:12,335 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336114Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336245Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO - 🔍 Verificação inicial do ambiente...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336315Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336435Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336519Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336602Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336717Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.336793Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.337086Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.337180Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.337248Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.337313Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO - 🔍 Verificando 6 localizações possíveis do .env...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.337387Z","level":"info","event":"📋 [2025-06-06 15:16:12]   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.337490Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO -   A verificar: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.337627Z","level":"info","event":"📋 [2025-06-06 15:16:12]   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.338231Z","level":"info","event":"📋 2025-06-06 15:16:12,336 - INFO -   ❌ Não encontrado: /opt/airflow/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.338315Z","level":"info","event":"📋 [2025-06-06 15:16:12]   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.338379Z","level":"info","event":"📋 2025-06-06 15:16:12,337 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.338486Z","level":"info","event":"📋 [2025-06-06 15:16:12] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.339383Z","level":"info","event":"📋 2025-06-06 15:16:12,337 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.339489Z","level":"info","event":"📋 [2025-06-06 15:16:12] 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.339598Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.339688Z","level":"info","event":"📋 [2025-06-06 15:16:12]   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.339797Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_USER do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.339906Z","level":"info","event":"📋 [2025-06-06 15:16:12]   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340003Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_PASSWORD do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340173Z","level":"info","event":"📋 [2025-06-06 15:16:12]   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340359Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_HOST do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340474Z","level":"info","event":"📋 [2025-06-06 15:16:12]   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340627Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_PORT do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340710Z","level":"info","event":"📋 [2025-06-06 15:16:12]   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340800Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_NAME do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.340918Z","level":"info","event":"📋 [2025-06-06 15:16:12]   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341046Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_SCHEMA do .env","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341214Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341328Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO - 🔍 Verificação final da configuração...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341400Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341488Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   DB_HOST: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341608Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341680Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   DB_USER: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341755Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341828Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   DB_PASSWORD: DEFINIDO","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341894Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.341989Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   DB_PORT: 6543","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342049Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342108Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   DB_NAME: postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342167Z","level":"info","event":"📋 [2025-06-06 15:16:12]   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342226Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO -   DB_SCHEMA: google_scraper","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342303Z","level":"info","event":"📋 [2025-06-06 15:16:12] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342388Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342461Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.342932Z","level":"info","event":"📋 2025-06-06 15:16:12,338 - INFO - 🔗 A conectar à base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.705312Z","level":"info","event":"📋 [2025-06-06 15:16:12] ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.705861Z","level":"info","event":"📋 2025-06-06 15:16:12,705 - INFO - ✅ Conectado à base de dados com sucesso","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.773401Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.774176Z","level":"info","event":"📋 2025-06-06 15:16:12,772 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.846106Z","level":"info","event":"📋 [2025-06-06 15:16:12] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.848621Z","level":"info","event":"📋 2025-06-06 15:16:12,845 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.941520Z","level":"info","event":"📋 [2025-06-06 15:16:12] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.944787Z","level":"info","event":"📋 2025-06-06 15:16:12,941 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.948638Z","level":"info","event":"📋 [2025-06-06 15:16:12] 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.949187Z","level":"info","event":"📋 2025-06-06 15:16:12,941 - INFO - 🔧 A preparar dataframe para inserção na base de dados...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.949393Z","level":"info","event":"📋 [2025-06-06 15:16:12] 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.949577Z","level":"info","event":"📋 2025-06-06 15:16:12,941 - INFO - 📅 A converter formatos de data...","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.952226Z","level":"info","event":"📋 [2025-06-06 15:16:12] ✅ Preparadas 15 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:12.952676Z","level":"info","event":"📋 2025-06-06 15:16:12,952 - INFO - ✅ Preparadas 15 linhas para inserção","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.661436Z","level":"info","event":"📋 [2025-06-06 15:16:13] ✅ Inseridos/atualizados 15 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.661869Z","level":"info","event":"📋 2025-06-06 15:16:13,661 - INFO - ✅ Inseridos/atualizados 15 artigos (falharam: 0)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.667103Z","level":"info","event":"📋 [2025-06-06 15:16:13] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.667624Z","level":"info","event":"📋 2025-06-06 15:16:13,667 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.668548Z","level":"info","event":"📋 [2025-06-06 15:16:13] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.672527Z","level":"info","event":"📋 2025-06-06 15:16:13,668 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.673507Z","level":"info","event":"📋 [2025-06-06 15:16:13] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.675481Z","level":"info","event":"📋 2025-06-06 15:16:13,668 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.675610Z","level":"info","event":"📋 [2025-06-06 15:16:13] ✅ Exportação concluída com sucesso. Inseridos/atualizados 15 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.675688Z","level":"info","event":"📋 2025-06-06 15:16:13,668 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 15 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.675806Z","level":"info","event":"📋 [2025-06-06 15:16:13] 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.675872Z","level":"info","event":"📋 2025-06-06 15:16:13,668 - INFO - 🔗 Ligação à base de dados fechada","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.675933Z","level":"info","event":"📋 [2025-06-06 15:16:13] ✅ Exportação concluída com sucesso. Processados 15 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.675993Z","level":"info","event":"📋 2025-06-06 15:16:13,668 - INFO - ✅ Exportação concluída com sucesso. Processados 15 artigos","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.754371Z","level":"info","event":"✅ Export completed successfully!","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.754776Z","level":"info","event":"🔍 Verifying export outputs:","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.754976Z","level":"info","event":"⚠️ export_log: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_log_20250606.log (not found)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.755121Z","level":"info","event":"✅ export_stats: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json (931 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.755423Z","level":"info","event":"✅ backup_csv: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv (3799 bytes)","chan":"stdout","logger":"task"}
{"timestamp":"2025-06-06T14:16:13.755934","level":"info","event":"Done. Returned value was: [2025-06-06 15:16:12] A iniciar export_to_supabase_airflow\n2025-06-06 15:16:12,329 - INFO - A iniciar export_to_supabase_airflow\n[2025-06-06 15:16:12] Parâmetros: date=2025-06-06\n2025-06-06 15:16:12,329 - INFO - Parâmetros: date=2025-06-06\n[2025-06-06 15:16:12] Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n2025-06-06 15:16:12,329 - INFO - Caminhos: input_file=/opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv, output_dir=/opt/airflow/scripts/google_scraper/data/processed/2025/06/06, date_str=2025-06-06\n[2025-06-06 15:16:12] 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n2025-06-06 15:16:12,329 - INFO - 🚀 A iniciar exportação para Supabase para a data: 2025-06-06\n[2025-06-06 15:16:12] 📋 Tabela de destino: artigos_filtrados_20250606_staging\n2025-06-06 15:16:12,329 - INFO - 📋 Tabela de destino: artigos_filtrados_20250606_staging\n[2025-06-06 15:16:12] 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n2025-06-06 15:16:12,329 - INFO - 📁 A usar diretório de saída controlado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06\n[2025-06-06 15:16:12] ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 15:16:12,329 - INFO - ✅ A usar ficheiro de entrada fornecido: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 15:16:12] 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n2025-06-06 15:16:12,329 - INFO - 📂 A carregar artigos de: /opt/airflow/scripts/google_scraper/data/structured/2025/06/06/artigos_google_municipios_pt_2025-06-06.csv\n[2025-06-06 15:16:12] 📊 Carregados 15 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n2025-06-06 15:16:12,335 - INFO - 📊 Carregados 15 artigos com colunas: ['ID', 'type', 'subtype', 'date', 'year', 'month', 'day', 'hour', 'georef', 'district', 'municipali', 'parish', 'DICOFREG', 'source', 'sourcedate', 'sourcetype', 'page', 'fatalities', 'injured', 'evacuated', 'displaced', 'missing']\n[2025-06-06 15:16:12] 📋 A processar todos os artigos relevantes relacionados com desastres\n2025-06-06 15:16:12,335 - INFO - 📋 A processar todos os artigos relevantes relacionados com desastres\n[2025-06-06 15:16:12] 🔍 Verificação inicial do ambiente...\n2025-06-06 15:16:12,336 - INFO - 🔍 Verificação inicial do ambiente...\n[2025-06-06 15:16:12]   DB_HOST do ambiente: NÃO_ENCONTRADO\n2025-06-06 15:16:12,336 - INFO -   DB_HOST do ambiente: NÃO_ENCONTRADO\n[2025-06-06 15:16:12]   DB_USER do ambiente: NÃO_ENCONTRADO\n2025-06-06 15:16:12,336 - INFO -   DB_USER do ambiente: NÃO_ENCONTRADO\n[2025-06-06 15:16:12]   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n2025-06-06 15:16:12,336 - INFO -   DB_PASSWORD do ambiente: NÃO_ENCONTRADO\n[2025-06-06 15:16:12] 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n2025-06-06 15:16:12,336 - INFO - 🔍 Configuração da base de dados não encontrada no ambiente, procurando ficheiro .env...\n[2025-06-06 15:16:12] 🔍 Verificando 6 localizações possíveis do .env...\n2025-06-06 15:16:12,336 - INFO - 🔍 Verificando 6 localizações possíveis do .env...\n[2025-06-06 15:16:12]   A verificar: /opt/airflow/.env\n2025-06-06 15:16:12,336 - INFO -   A verificar: /opt/airflow/.env\n[2025-06-06 15:16:12]   ❌ Não encontrado: /opt/airflow/.env\n2025-06-06 15:16:12,336 - INFO -   ❌ Não encontrado: /opt/airflow/.env\n[2025-06-06 15:16:12]   A verificar: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 15:16:12,337 - INFO -   A verificar: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 15:16:12] ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n2025-06-06 15:16:12,337 - INFO - ✅ Ficheiro .env encontrado em: /opt/airflow/scripts/google_scraper/.env\n[2025-06-06 15:16:12] 📄 Tamanho do ficheiro .env: 210 caracteres\n2025-06-06 15:16:12,338 - INFO - 📄 Tamanho do ficheiro .env: 210 caracteres\n[2025-06-06 15:16:12]   ✅ Definido DB_USER do .env\n2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_USER do .env\n[2025-06-06 15:16:12]   ✅ Definido DB_PASSWORD do .env\n2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_PASSWORD do .env\n[2025-06-06 15:16:12]   ✅ Definido DB_HOST do .env\n2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_HOST do .env\n[2025-06-06 15:16:12]   ✅ Definido DB_PORT do .env\n2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_PORT do .env\n[2025-06-06 15:16:12]   ✅ Definido DB_NAME do .env\n2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_NAME do .env\n[2025-06-06 15:16:12]   ✅ Definido DB_SCHEMA do .env\n2025-06-06 15:16:12,338 - INFO -   ✅ Definido DB_SCHEMA do .env\n[2025-06-06 15:16:12] 🔍 Verificação final da configuração...\n2025-06-06 15:16:12,338 - INFO - 🔍 Verificação final da configuração...\n[2025-06-06 15:16:12]   DB_HOST: DEFINIDO\n2025-06-06 15:16:12,338 - INFO -   DB_HOST: DEFINIDO\n[2025-06-06 15:16:12]   DB_USER: DEFINIDO\n2025-06-06 15:16:12,338 - INFO -   DB_USER: DEFINIDO\n[2025-06-06 15:16:12]   DB_PASSWORD: DEFINIDO\n2025-06-06 15:16:12,338 - INFO -   DB_PASSWORD: DEFINIDO\n[2025-06-06 15:16:12]   DB_PORT: 6543\n2025-06-06 15:16:12,338 - INFO -   DB_PORT: 6543\n[2025-06-06 15:16:12]   DB_NAME: postgres\n2025-06-06 15:16:12,338 - INFO -   DB_NAME: postgres\n[2025-06-06 15:16:12]   DB_SCHEMA: google_scraper\n2025-06-06 15:16:12,338 - INFO -   DB_SCHEMA: google_scraper\n[2025-06-06 15:16:12] ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n2025-06-06 15:16:12,338 - INFO - ✅ Configuração da base de dados carregada: aws-0-eu-west-3.pooler.supabase.com:6543/postgres\n[2025-06-06 15:16:12] 🔗 A conectar à base de dados...\n2025-06-06 15:16:12,338 - INFO - 🔗 A conectar à base de dados...\n[2025-06-06 15:16:12] ✅ Conectado à base de dados com sucesso\n2025-06-06 15:16:12,705 - INFO - ✅ Conectado à base de dados com sucesso\n[2025-06-06 15:16:12] 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n2025-06-06 15:16:12,772 - INFO - 🗑️ Tabela existente google_scraper.artigos_filtrados_20250606_staging eliminada se existia\n[2025-06-06 15:16:12] ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n2025-06-06 15:16:12,845 - INFO - ✅ Tabela google_scraper.artigos_filtrados_20250606_staging criada com esquema correto\n[2025-06-06 15:16:12] ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n2025-06-06 15:16:12,941 - INFO - ✅ Índices criados para a tabela google_scraper.artigos_filtrados_20250606_staging\n[2025-06-06 15:16:12] 🔧 A preparar dataframe para inserção na base de dados...\n2025-06-06 15:16:12,941 - INFO - 🔧 A preparar dataframe para inserção na base de dados...\n[2025-06-06 15:16:12] 📅 A converter formatos de data...\n2025-06-06 15:16:12,941 - INFO - 📅 A converter formatos de data...\n[2025-06-06 15:16:12] ✅ Preparadas 15 linhas para inserção\n2025-06-06 15:16:12,952 - INFO - ✅ Preparadas 15 linhas para inserção\n[2025-06-06 15:16:13] ✅ Inseridos/atualizados 15 artigos (falharam: 0)\n2025-06-06 15:16:13,661 - INFO - ✅ Inseridos/atualizados 15 artigos (falharam: 0)\n[2025-06-06 15:16:13] 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 15:16:13,667 - INFO - 💾 Backup de exportação guardado: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 15:16:13] ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n2025-06-06 15:16:13,668 - INFO - ✅ Estatísticas de exportação guardadas: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_stats_20250606.json\n[2025-06-06 15:16:13] 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n2025-06-06 15:16:13,668 - INFO - 📋 Localização de backup de exportação preparada: /opt/airflow/scripts/google_scraper/data/processed/2025/06/06/export_backup_20250606.csv\n[2025-06-06 15:16:13] ✅ Exportação concluída com sucesso. Inseridos/atualizados 15 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n2025-06-06 15:16:13,668 - INFO - ✅ Exportação concluída com sucesso. Inseridos/atualizados 15 todos os artigos relevantes relacionados com desastres na tabela artigos_filtrados_20250606_staging\n[2025-06-06 15:16:13] 🔗 Ligação à base de dados fechada\n2025-06-06 15:16:13,668 - INFO - 🔗 Ligação à base de dados fechada\n[2025-06-06 15:16:13] ✅ Exportação concluída com sucesso. Processados 15 artigos\n2025-06-06 15:16:13,668 - INFO - ✅ Exportação concluída com sucesso. Processados 15 artigos\n","logger":"airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator"}
