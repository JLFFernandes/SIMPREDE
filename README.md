# EM_DAT
Este programa foi desenvolvido para automatizar um processo de obtenção, filtragem e inserção de dados relativos a desastres no PostgreSQL. Inicialmente, o script utiliza o Selenium para efetuar o login na plataforma EM-DAT, onde é necessário autenticar com um endereço de email e uma password para aceder a base de dados. Após o login, o programa aguarda a carga da página e clica num botão "Go" que direciona para a área de dados. Nessa fase, é efetuada a seleção de critérios: escolhe-se a classificação "Natural" e o continente "Europe". Com esses filtros aplicados, o script clica no ícone de download para obter um ficheiro Excel com os dados correspondentes, salvando-o numa pasta temporária.
Após a conclusão do download, o programa passa à fase de importação dos dados para uma base de dados PostgreSQL. O ficheiro Excel é lido utilizando a biblioteca Pandas e, neste ponto, é exibida uma lista das colunas encontradas. Em seguida, aplica-se um filtro para selecionar apenas os registos onde a coluna "Country" seja igual a "Portugal" e a coluna "Disaster Type" seja igual a "Flood" (comparações efetuadas de forma a ignorar diferenças de maiúsculas e minúsculas). Caso nenhum registo cumpra estes critérios, o programa informa que nenhum registo foi encontrado para os parâmetros especificados.
Se existirem dados válidos, o script estabelece uma ligação à base de dados PostgreSQL através da biblioteca psycopg2. Para cada registo no DataFrame filtrado, o programa utiliza funções auxiliares – como a função safe_int para garantir que os valores numéricos se encontrem dentro dos limites permitidos e a função safe_str para assegurar que as cadeias de texto não excedam um comprimento máximo – de forma a prevenir erros de inserção. O programa ainda constrói a data do evento a partir dos valores das colunas "Start Year", "Start Month" e "Start Day", ajustando valores zero para garantir datas válidas.
Para cada registo, são efetuadas várias inserções: uma entrada é criada na tabela de desastres, sendo que o ID gerado é utilizado como chave para as entradas relacionadas em outras tabelas. A função extract_district_name é invocada para extrair o nome do distrito a partir da coluna "Admin Units", que pode conter uma string em formato JSON ou texto truncado. Posteriormente, os dados são inseridos nas tabelas correspondentes a localização, impactos humanos e fontes de informação, garantindo assim que todas as informações relevantes sejam corretamente armazenadas na base de dados.
O programa inclui ainda robustos mecanismos de tratamento de exceções, de forma a identificar e reportar erros tanto durante o processo de download como na fase de inserção de dados, como a ocorrência de duplicidades que podem ser bloqueadas por triggers ou restrições na base de dados. Desta forma, o script proporciona um fluxo automatizado e controlado, desde a obtenção dos dados no website até à sua inserção segura e estruturada na base de dados, permitindo a atualização e análise dos registos de desastres com base em critérios específicos.

